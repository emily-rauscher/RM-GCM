      SUBROUTINE DOUBLEGRAY_OPPRMULTI(TAURAY,TAUL,TAUGAS,TAUAER,solar_calculation_indexer,DPG,
     &                                LLA, LLS, JDBLE, JDBLEDBLE, JN, JN2, iblackbody_above, ISL, IR, IRS,EMISIR,
     &                                EPSILON, HEATI, HEATS, HEAT, SOLNET,TPI, SQ3, SBK,AM, AVG, ALOS,
     &  SCDAY,RGAS,GANGLE,GWEIGHT,GRATIO,EMIS,RSFX,NPROB,SOL,RAYPERBAR,WEIGHT,
     &  GOL,WOL,WAVE,TT,Y3,U0,FDEGDAY,
     &  WOT,GOT,PTEMPG,PTEMPT,G0,OPD,PTEMP,
     &  uG0,uTAUL,W0,uW0,uopd,U1S,
     &  U1I,TOON_AK,B1,B2,EE1,EM1,
     &  EM2,EL1,EL2,GAMI,AF,
     &  BF,EF,SFCS,B3,CK1,CK2,
     &  CP,CPB,CM,CMB,DIRECT,EE3,
     &  EL3,FNET,TMI,AS,DF,
     &  DS,XK,DIREC,DIRECTU,DINTENT,
     &  UINTENT,TMID,TMIU,tslu,total_downwelling,alb_tot,
     &  tiru,firu,fird,fsLu,fsLd,fsLn,alb_toa,fupbs,
     &  fdownbs,fnetbs,fdownbs2,fupbi,fdownbi,fnetbi,
     &  qrad,alb_tomi,alb_toai)
!
!     **************************************************************
!     *  Purpose             :  CaLculates optical properties      *
!     *                         such as single scattering albedo,  *
!     *                         asymmetry parameter, etc.          *
!     *                         This routine is case dependent and *
!     *                         wiLL have to be repLaced by the    *
!     *                         user.                              *
!     *  Subroutines Called  :  None                               *
!     *  Output              :  TAUL, W0, G0, OPD, Y3              *
!     * ************************************************************
!
      include 'rcommons.h'

      INTEGER LLA, LLS, JDBLE, JDBLEDBLE, JN, JN2, iblackbody_above, ISL, IR, IRS, j1
      REAL EMISIR, EPSILON, HEATI(51), HEATS(51), HEAT(51), SOLNET
      REAL TPI, SQ3, SBK,AM, AVG, ALOS
      REAL SCDAY, RGAS, GANGLE(3), GWEIGHT(3), GRATIO(3), EMIS(5), RSFX(5),NPROB(5), SOL(5),RAYPERBAR(5),WEIGHT(5)
      REAL GOL(5,2*50+2), WOL(5,2*50+2), WAVE(5+1), TT(50+1), Y3(5,3,2*50+2), U0, FDEGDAY
      REAL WOT, GOT, PTEMPG(5), PTEMPT(5), G0(5,2*50+2), OPD( 5,2*50+2), PTEMP(5,2*50+2)
      REAL uG0(5,2*50+2), uTAUL(5,2*50+2), W0(5,2*50+2), uW0(5,2*50+2), uopd(5,2*50+2),  U1S( 5)
      REAL U1I(5), TOON_AK(5,2*50+2), B1(5,2*50+2), B2(  5,2*50+2), EE1( 5,2*50+2), EM1(5,2*50+2)
      REAL EM2(5,2*50+2), EL1( 5,2*50+2), EL2(5,2*50+2), GAMI(5,2*50+2), AF(5,4*50+4)
      REAL BF(5,4*50+4), EF(5,4*50+4), SFCS(5), B3(5,2*50+2), CK1(5,2*50+2), CK2(5,2*50+2)
      REAL CP(5,2*50+2), CPB(5,2*50+2), CM(5,2*50+2), CMB(5,2*50+2), DIRECT(5,2*50+2), EE3(5,2*50+2)
      REAL EL3(5,2*50+2), FNET(5,2*50+2), TMI(5,2*50+2), AS(5,4*50+4), DF(5,4*50+4)
      REAL DS(5,4*50+4), XK(5,4*50+4), DIREC(5,2*50+2), DIRECTU(5,2*50+2), DINTENT(5,3,2*50+2)
      REAL UINTENT(5,3,2*50+2), TMID(5,2*50+2), TMIU(5,2*50+2), tslu,total_downwelling,alb_tot
      REAL tiru,firu(2),fird(2),fsLu(3), fsLd(3),fsLn(3),alb_toa(3), fupbs(50+1)
      REAL fdownbs(50+1),fnetbs(50+1),fdownbs2(50+1), fupbi(50+1),fdownbi(50+1),fnetbi(50+1)
      REAL qrad(50+1),alb_tomi,alb_toais

      REAL DPG(51), DENOM

      integer solar_calculation_indexer

      REAL TCONKCL(50+1)
      REAL KCLQEVIS(50),KCLG0VIS(50),KCLPI0VIS(50)
      REAL KCLQEVIR(50),KCLG0VIR(50),KCLPI0VIR(50)
      REAL TCONZNS(50+1)
      REAL ZNSQEVIS(50),ZNSG0VIS(50),ZNSPI0VIS(50)
      REAL ZNSQEVIR(50),ZNSG0VIR(50),ZNSPI0VIR(50)
      REAL TCONNA2S(50+1)
      REAL NA2SQEVIS(50),NA2SG0VIS(50),NA2SPI0VIS(50)
      REAL NA2SQEVIR(50),NA2SG0VIR(50),NA2SPI0VIR(50)
      REAL TCONMnS(50+1)
      REAL MnSQEVIS(50),MnSG0VIS(50),MnSPI0VIS(50)
      REAL MnsQEVIR(50),MnSG0VIR(50),MnSPI0VIR(50)
      !REAL TCONcr(50+1)
      REAL TCONCR(51)
      REAL crQEVIS(50),crG0VIS(50),crPI0VIS(50)
      REAL crQEVIR(50),crG0VIR(50),crPI0VIR(50)
      REAL TCONSiO2(50+1)
      REAL SiO2QEVIS(50),SiO2G0VIS(50),SiO2PI0VIS(50)
      REAL SiO2QEVIR(50),SiO2G0VIR(50),SiO2PI0VIR(50)
      REAL TCONMg2SiO4(50+1)
      REAL Mg2SiO4QEVIS(50),Mg2SiO4G0VIS(50),Mg2SiO4PI0VIS(50)
      REAL Mg2SiO4QEVIR(50),Mg2SiO4G0VIR(50),Mg2SiO4PI0VIR(50)
      REAL TCONVO(50+1)
      REAL VOQEVIS(50),VOG0VIS(50),VOPI0VIS(50)
      REAL VOQEVIR(50),VOG0VIR(50),VOPI0VIR(50)
      REAL TCONNi(50+1)
      REAL NiQEVIS(50),NiG0VIS(50),NiPI0VIS(50)
      REAL NiQEVIR(50),NiG0VIR(50),NiPI0VIR(50)
      REAL TCONFe(50+1)
      REAL FeQEVIS(50),FeG0VIS(50),FePI0VIS(50)
      REAL FeQEVIR(50),FeG0VIR(50),FePI0VIR(50)
      REAL TCONCaSiO4(50+1)
      REAL CaSiO4QEVIS(50),CaSiO4G0VIS(50),CaSiO4PI0VIS(50)
      REAL CaSiO4QEVIR(50),CaSiO4G0VIR(50),CaSiO4PI0VIR(50)
      REAL TCONCaTiO3(50+1)
      REAL CaTiO3QEVIS(50),CaTiO3G0VIS(50),CaTiO3PI0VIS(50)
      REAL CaTiO3QEVIR(50),CaTiO3G0VIR(50),CaTiO3PI0VIR(50)
      REAL TCONAL2O3(50+1),TCONDS(50+1,13)
      REAL Al2O3QEVIS(50),Al2O3G0VIS(50),Al2O3PI0VIS(50)
      REAL Al2O3QEVIR(50),Al2O3G0VIR(50),Al2O3PI0VIR(50)
      REAL MOLEF(13),DENSITY(13),RPS(50),TAUFACT,FMOLW(13)
      REAL QEVIS(50+1,13),PI0VIS(50+1,13),G0VIS(50+1,13)
      REAL QEIR(50+1,13),PI0IR(50+1,13),G0IR(50+1,13)
      REAL CONDFACT(50+1,13),TAUAERSW(50+1,13),TAUAERLW(50+1,13)
      REAL CLOUDLOC(50+1,13),ZEROARR(50+1),CORFACT(50+1)
      INTEGER K,JJ,J,NCLOUD,BASELEV,TOPLEV,L

      real, dimension(NIR+NSOL,2*50+2) :: TAURAY, TAUL, TAUGAS,TAUAER



      DATA NCLOUD/13/

      DATA   DENSITY/1.98e3,4.09e3,1.86e3,4.0e3,5.22e3,2.65e3,3.27e3,
     &                5.76e3,8.9e3, 7.9e3,3.34e3,3.98e3,3.95e3/

      DATA   FMOLW/31.59,41.30,33.07,36.87,64.40,25.46,59.61,28.37,
     &                  24.87, 23.66, 72.99, 50.83, 43.20  /

      DATA CORFACT/1.0,1.0,1.0,1.0,1.0,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000/

!    KCl
      DATA   TconKCl /617.032,621.573,626.038,630.552,635.053, 639.555,
     &         644.050,648.556,653.049,657.552,662.043,666.609,671.436,
     &         676.532,681.879,687.233,692.462,697.665,702.916,708.306,
     &         713.767,719.366,725.024,730.775,736.460,742.266,748.065,
     &        753.932,759.779,765.571, 771.346,777.201,783.301,789.715,
     &         796.379,803.117,809.863,816.737,823.798,831.052,838.426,
     &         845.980,853.873,862.074,870.494,878.913,887.351,895.768,
     &           904.198,912.867,917.385/

!ZnS
      DATA   TconZnS /708.296,712.010,716.704,719.507,722.309,727.329,
     &                730.718,736.323,739.126,744.731,747.534,753.139,
     &                755.942,761.547,764.350,769.955,772.758,778.363,
     &                783.969,788.079,792.377,797.982,803.587,806.390,
     &                811.995,815.183,823.206,828.812,834.364,840.022,
     &                845.628,851.233,856.839,862.444,868.049,873.655,
     &                879.260,884.865,890.471,896.076,901.682,907.287,
     &                915.695,921.897,929.708,936.547,943.722,949.327,
     &                955.732,963.063, 966.143/

!    Na2S
      DATA   TconNa2S /776.182,781.957,787.715,793.430,799.135,804.761,
     &              810.359, 815.868, 821.297, 826.731, 832.157,837.761,
     &              843.767,850.179,856.911,863.688,870.458,877.165,
     &              884.006, 890.930,897.948, 905.112,912.216,919.374,
     &              926.464,933.659,940.930,948.253,955.902,963.944,
     &              972.372,980.941,989.400,998.113,1007.19,1016.45,1025.51,
     &              1035.47,1044.52,1054.07,1063.67,1073.49,1083.32,1093.15,
     &              1103.16,1113.41,1123.84,1134.53,1145.92,1158.12,
     &              1164.38/


!     MnS
      DATA TCONMnS /1113.43, 1120.07,1126.64,1133.21,1139.9,1146.46,
     &        1153.15,  1159.65, 1166.25, 1173.01, 1180.09, 1187.73,
     &        1194.69, 1202.12, 1209.26, 1216.50, 1223.92, 1231.43,
     &       1239.19, 1247.17, 1255.39,1263.78, 1272.32,1281.40,
     &        1289.69, 1297.76, 1306.00, 1315.24, 1324.18, 1333.27,
     &        1342.44, 1351.39, 1360.54, 1369.99, 1379.72, 1389.42,
     &        1399.22, 1409.04,  1418.99,1428.77, 1438.60, 1449.11,
     &        1459.19, 1469.78, 1481.06, 1492.70, 1504.21, 1515.49,
     &            1527.84,1540.17,1545.90/

      DATA TconCr /1180, 1189, 1197, 1205, 1213, 1221, 1229, 1237, 1246, 1254,
     &             1262, 1270, 1279, 1289, 1300, 1311, 1321, 1332, 1342, 1353,
     &             1364, 1374, 1385, 1396, 1406, 1417, 1428, 1439, 1453, 1466,
     &             1480, 1493, 1507, 1520, 1534, 1548, 1561, 1575, 1588, 1602,
     &             1617, 1633, 1649, 1665, 1681, 1697, 1713, 1729, 1745, 1761, 1791/

!    SiO2
      DATA TCONSiO2 /1334.63,1342.58,1350.30,1358.48,1366.64,1374.85,
     &             1383.15,1391.59,1400.10,1408.68, 1417.25,1425.87,
     &             1434.53, 1443.14, 1451.71,1460.28,1468.90,1477.44,
     &             1486.12,1494.77,1503.91,1513.72 ,1524.07, 1534.57,
     &             1544.98,1555.25, 1565.35,1575.40, 1585.44,1595.55,
     &             1606.04,1617.06, 1628.55,1640.25,1651.98, 1664.07,
     &             1676.82,1689.97,1703.53, 1717.16, 1731.36, 1746.01,
     &             1761.10,1776.94, 1793.70,1811.36,1829.60, 1848.37,
     &             1867.54, 1887.00, 1896.46/

!    Mg2SiO4
      DATA   TCONMg2SiO4 /1370.00,1378.31,1386.62,1395.03,1403.56,
     &           1412.29,
     &           1421.17, 1430.18, 1439.17, 1448.16, 1457.24,1466.52,
     &           1475.94,1485.57, 1495.23, 1505.09, 1515.04, 1525.21,
     &           1535.33,1545.80, 1556.37, 1567.12,1578.02, 1589.13,
     &           1600.29, 1611.67,1623.20, 1634.84,1646.61,1658.58,
     &           1670.74, 1683.03, 1695.59, 1708.44,1721.29,1734.41,
     &           1747.86, 1761.64, 1775.79, 1789.95, 1804.36,1819.11,
     &           1834.34, 1850.41, 1867.40, 1885.24,1903.85,1923.11,
     &           1943.09, 1963.67, 1974.17/

!    VO
      DATA TconVO/ 1363.07,1371.53, 1379.98, 1389.36,1399.69,1409.65,
     &            1419.40, 1429.94, 1439.11,1450.21, 1458.82,1470.07,
     &       1481.33,1492.58,1503.61,1513.72,1526.34,1536.53,1547.03,
     &              1557.31,1569.87,1580.06,1591.07, 1603.14,1616.05,
     &          1627.63, 1639.06, 1652.94, 1664.91, 1677.84, 1690.74,
     &             1703.56,1716.58,1729.50, 1742.92,1756.97, 1771.03,
     &            1783.97, 1796.90,1810.39, 1824.44,1838.46, 1852.55,
     &           1867.09, 1880.66, 1897.51,1914.24, 1929.95, 1945.67,
     &               1964.18,1972.03/

!    Ni
      DATA  TconNi/ 1315.67, 1323.99,1333.24,1343.43,1353.31,1363.35,
     &      1373.31,1383.34,1393.43,1403.31, 1412.86,1421.18,1432.30,
     &      1443.43,1454.55,1465.97,1478.76,1491.77,1504.48, 1515.78,
     &      1529.72,1540.84,1554.77, 1568.23,1580.96,1593.81,1607.69,
     &      1622.14,1635.56,1650.51,1666.23,1681.67,1697.25,1713.65,
     &      1728.42,1746.81,1766.68,1786.23,1800.17,1817.54,1838.73,
     &      1857.11,1878.31, 1896.69,1917.47,1936.26,1957.45,1973.04,
     &      1994.22, 2018.22, 2028.81/

!    Fe
      DATA   TCONFe /1362.14,1373.43, 1384.60,1395.83, 1407.00,1418.26,
     &              1430.00,1442.48, 1455.61, 1469.10, 1482.58,1496.08,
     &              1509.58,1523.08,1536.57,1550.07,1563.57,1577.13,
     &              1590.57,1604.74,1619.69, 1635.41, 1651.59, 1667.75,
     &             1684.03,1700.80, 1718.31, 1736.60, 1755.27, 1773.98,
     &             1792.93, 1812.32,1832.10, 1852.28,1872.54, 1892.90,
     &             1913.24, 1934.27, 1956.41,1978.37, 2008.05, 2030.80,
     &             2051.13, 2081.89, 2103.84, 2132.13,2157.98, 2190.91,
     &              2221.92, 2247.77, 2263.48/

!    CaSiO4
      DATA  TconCaSiO4/1508.24,1518.14,1527.48,1536.15,1544.81,1556.36,
     &      1565.02, 1573.68, 1585.23, 1593.89, 1604.95,1614.10,1625.65,
     &     1634.31,1645.86, 1656.04, 1666.07, 1677.62,1689.17, 1700.23,
     &      1712.27,1722.50, 1735.37,1746.92,1758.47,1772.69,1784.45,
     &      1796.00, 1810.24, 1821.99,1835.26,1847.97,1862.41,1876.85,
     &       1891.14,1903.65,1919.06,1934.48, 1949.03,1963.46,1980.70,
     &       1995.22,2011.50, 2026.98, 2044.31,2060.60,2078.90,2097.18,
     &         2118.35,2139.54, 2150.11/

!    CaTiO3
!      DATA  TconCaTiO3/1600.35,1609.68,1616.74,1626.47,1633.19,
!     &     1643.94, 1652.50,1662.08,1672.50,1681.30,1692.50,1703.94,
!     &     1712.95,1723.94,1735.02,1744.61,1755.37,1766.81,1778.25,
!     &     1788.78,1798.49,1810.72,1821.12,1832.96,1845.32,1855.43,
!     &     1867.42,1879.89,1892.37,1904.05,1917.31,1929.79,1941.23,
!     &     1952.67,1966.98,1979.67,1992.73,2007.04,2021.35,2035.31,
!     &     2047.77,2063.12,2078.59,2096.68,2112.02,2130.14,2144.45,
!     &     2161.64,2182.03,2204.63, 2213.67/

      DATA TconCaTiO3 /1595, 1604, 1612, 1621, 1630, 1638, 1649, 1659, 1669, 1679,
     &                1689, 1699, 1709, 1719, 1730, 1740, 1750, 1760, 1770, 1780,
     &                1790, 1800, 1812, 1825, 1838, 1850, 1863, 1876, 1889, 1902,
     &                1914, 1927, 1940, 1953, 1966, 1979, 1994, 2009, 2023, 2038,
     &                2053, 2068, 2083, 2098, 2113, 2128, 2143, 2158, 2173, 2187, 2200/

!    Al2O3
       DATA   TCONAl2O3 /1685.09, 1693.08, 1700.92,1708.84, 1716.78,
     &              1724.79,1732.91, 1741.42,1750.37,1759.75,
     &              1769.31,1779.06,1789.37,1799.94, 1810.65,1820.94,
     &              1830.99,1841.08,1851.02, 1861.02,1871.26,1881.74,
     &              1892.36,1903.03,1913.69,1924.39,1935.05,1945.95,
     &              1957.45,1969.45,1980.72,1989.12,1995.54, 2002.05,
     &              2010.76,2021.69,2033.01,2044.36, 2055.67,2066.99,
     &              2078.33,2089.65,2100.99,2112.62,2124.88,2137.43,
     &              2150.32,2163.28, 2176.89, 2191.32,2198.76/



      DATA rps/ 0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,0.1000e-6,
     &  0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,
     &  0.1000e-6,  0.1000e-6,
     &   0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,
     &   0.1023e-6,  0.1060e-6,
     &   0.1108e-6,  0.1170e-6,  0.1250e-6,  0.1360e-6,  0.1510e-6,
     &   0.1700e-6,  0.1950e-6,
     &   0.2285e-6,  0.2723e-6,  0.3300e-6,  0.4060e-6,  0.5060e-6,
     &   0.6387e-6,  0.8130e-6,
     &   1.0430e-6,  1.3458e-6,  1.7450e-6,  2.2710e-6,  2.9660e-6,
     &   3.8800e-6,  5.0870e-6,
     &   6.6767e-6,  8.7720e-6, 11.536e-6, 15.1780e-6, 19.9800e-6,
     &  26.3100e-6, 34.6500e-6, 45.6500e-6, 60.1540e-6, 79.2700e-6/

      !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      !!!!!!!!!!!!!!!!!!!! CLOUD SCATTERING PARAMETERS !!!!!!!!!!!!!!!!!!!!!!!!!!!!
      !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!


      DATA KClqevis/0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.179,
     &    0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.179,0.291,
     &    0.291,0.451,0.451,0.671,1.596,2.029,2.61,3.293,4.021,4.186,
     &    3.064,1.645,2.777,2.668,2.328,1.999,2.049,2.282,2.28,2.068,
     &    2.145,2.094,2.119,2.051,2.071,2.034,2.036,2.04,2.018/

      DATA KClg0vis/0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.184,
     &    0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.184,0.25,
     &    0.25,0.345,0.345,0.477,0.634,0.637,0.713,0.742,0.765,0.754,
     &    0.671,0.465,0.767,0.755,0.75,0.724,0.789,0.81,0.812,0.797,
     &    0.816,0.818,0.822,0.827,0.83,0.827,0.83,0.833,0.832/

      DATA KClqevir/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,
     &    0.0,0.001,0.001,0.001,0.001,0.002,0.003,0.006,0.016,0.027,
     &    0.08,0.224,0.534,0.794,1.771,2.942,4.022,3.909,2.523,1.824,
     &    2.827,1.886,2.188,2.237,2.099,2.108,2.054,2.218,2.059/

      DATA KClg0vir/0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,
     &    0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.004,
     &    0.004,0.005,0.005,0.007,0.013,0.017,0.022,0.029,0.051,0.068,
     &    0.119,0.214,0.408,0.548,0.634,0.744,0.771,0.748,0.597,0.574,
     &    0.8,0.75,0.761,0.779,0.787,0.812,0.825,0.848,0.851/

      DATA ZnSqevis/1.204,1.204,1.204,1.204,1.204,1.204,1.204,1.204,1.204,1.204,1.204,
     &    1.204,1.204,1.204,1.204,1.204,1.204,1.204,1.204,1.204,2.531,
     &    2.531,5.72,5.72,4.379,4.228,3.145,1.865,1.291,3.384,2.656,
     &    2.623,2.561,2.706,2.196,2.427,2.236,2.115,2.131,2.068,2.092,
     &    2.099,2.096,2.07,2.052,2.049,2.041,2.036,2.029,2.024/

      DATA ZnSg0vis/0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.344,
     &    0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.344,0.507,
     &    0.507,0.432,0.432,0.301,0.379,0.153,0.092,0.167,0.699,0.593,
     &    0.628,0.575,0.661,0.584,0.657,0.665,0.659,0.696,0.722,0.76,
     &    0.786,0.811,0.828,0.842,0.852,0.855,0.858,0.859,0.859/

      DATA ZnSqevir/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.001,
     &    0.001,0.001,0.001,0.001,0.004,0.007,0.012,0.022,0.071,0.129,
     &    0.434,1.449,5.253,4.055,4.046,2.474,2.068,2.369,2.721,1.952,
     &    2.361,2.134,2.317,2.299,2.183,2.136,2.128,2.049,2.149/

      DATA ZnSg0vir/0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,
     &    0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.006,
     &    0.006,0.008,0.008,0.011,0.019,0.025,0.033,0.043,0.076,0.102,
     &    0.187,0.39,0.398,0.335,0.358,0.085,0.509,0.46,0.473,0.471,
     &    0.539,0.559,0.627,0.666,0.665,0.67,0.686,0.691,0.732/

      DATA Na2Sqevis/0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.494,
     &    0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.494,0.805,
     &    0.805,1.282,1.282,2.205,3.303,4.516,4.265,4.759,2.687,2.094,
     &    2.86,2.41,2.705,2.177,2.151,2.196,2.143,2.189,2.167,2.128,
     &    2.094,2.083,2.068,2.057,2.047,2.043,2.036,2.029,2.024/

      DATA Na2Sg0vis/0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,
     &    0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.22,0.309,
     &    0.309,0.445,0.445,0.57,0.525,0.631,0.612,0.591,0.466,0.32,
     &    0.679,0.685,0.756,0.733,0.769,0.821,0.845,0.878,0.896,0.908,
     &    0.913,0.917,0.918,0.918,0.918,0.918,0.918,0.918,0.918/

      DATA Na2Sqevir/0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,
     &    0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.002,0.003,
     &    0.003,0.003,0.003,0.004,0.007,0.009,0.013,0.018,0.044,0.072,
     &    0.203,0.566,1.425,2.436,3.337,4.043,3.737,1.787,2.682,2.336,
     &    2.726,2.401,2.374,2.15,2.134,2.192,2.158,2.118,2.093/

      DATA Na2Sg0vir/0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,
     &    0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.005,
     &    0.005,0.006,0.006,0.008,0.014,0.019,0.025,0.033,0.058,0.077,
     &    0.136,0.253,0.504,0.584,0.573,0.603,0.508,0.324,0.718,0.716,
     &    0.772,0.806,0.828,0.835,0.865,0.883,0.901,0.912,0.919/

      DATA MnSqevis/2.772,2.772,2.772,2.772,2.772,2.772,2.772,2.772,2.772,2.772,2.772,
     &    2.772,2.772,2.772,2.772,2.772,2.772,2.772,2.772,2.772,6.887,
     &    6.887,4.668,4.668,4.421,2.451,1.51,1.833,2.95,2.243,2.929,
     &    2.07,2.566,2.161,3.07,1.966,2.023,2.333,2.17,1.857,1.964,
     &    2.215,2.143,2.201,2.063,2.102,2.061,1.993,1.998,2.007/

      DATA MnSg0vis/0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.516,
     &    0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.516,0.238,
     &    0.238,0.149,0.149,0.211,-0.071,0.277,0.42,0.48,0.209,0.495,
     &    0.386,0.49,0.547,0.554,0.496,0.528,0.602,0.589,0.55,0.575,
     &    0.636,0.639,0.659,0.65,0.673,0.673,0.678,0.699,0.723/

      DATA MnSqevir/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.001,
     &    0.001,0.001,0.001,0.002,0.005,0.009,0.016,0.029,0.096,0.178,
     &    0.634,3.288,4.446,5.143,3.615,1.582,2.652,2.715,1.847,2.169,
     &    2.239,2.189,2.067,1.941,1.965,2.478,2.235,2.213,2.153/

      DATA MnSg0vir/0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,
     &    0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.007,
     &    0.007,0.01,0.01,0.013,0.022,0.03,0.04,0.053,0.094,0.127,
     &    0.247,0.525,0.213,0.248,-0.023,0.436,0.408,0.478,0.397,0.478,
     &    0.557,0.51,0.547,0.527,0.551,0.625,0.617,0.626,0.627/

      DATA Crqevis/3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.079,
     &    3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.079,3.152,
     &    3.152,2.976,2.976,2.825,2.897,2.8,2.75,2.727,2.631,2.588,
     &    2.51,2.445,2.389,2.363,2.317,2.276,2.241,2.209,2.182,2.157,
     &    2.135,2.115,2.097,2.082,2.069,2.063,2.052,2.043,2.035/

      DATA Crg0vis/-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,
     &    -0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,-0.022,0.029,
     &    0.029,0.11,0.11,0.23,0.415,0.441,0.493,0.522,0.565,0.581,
     &    0.601,0.614,0.622,0.624,0.627,0.628,0.628,0.628,0.626,0.625,
     &    0.623,0.622,0.62,0.619,0.618,0.617,0.616,0.615,0.614/

      DATA Crqevir/0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.022,
     &    0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.022,0.027,
     &    0.027,0.034,0.034,0.041,0.061,0.077,0.1,0.14,0.327,0.535,
     &    1.401,2.45,2.416,2.305,2.416,2.329,2.285,2.249,2.207,2.177,
     &    2.151,2.13,2.112,2.098,2.087,2.081,2.073,2.065,2.059/

      DATA Crg0vir/-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,
     &    -0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.112,-0.134,
     &    -0.134,-0.157,-0.157,-0.179,-0.219,-0.234,-0.245,-0.251,-0.25,-0.24,
     &    -0.202,-0.128,0.031,0.165,0.32,0.404,0.45,0.48,0.497,0.509,
     &    0.515,0.519,0.521,0.522,0.522,0.522,0.522,0.521,0.521/

      DATA SiO2qevis/0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.159,
     &    0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.159,0.259,
     &    0.259,0.401,0.401,0.595,1.4,1.843,2.341,3.058,3.934,4.239,
     &    3.451,1.684,2.811,2.863,1.947,2.041,2.018,2.12,2.032,2.214,
     &    2.122,2.102,2.105,2.097,2.059,2.05,1.983,2.051,2.05/

      DATA SiO2g0vis/0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.181,
     &    0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.181,0.246,
     &    0.246,0.339,0.339,0.468,0.643,0.645,0.713,0.753,0.78,0.774,
     &    0.709,0.517,0.69,0.793,0.746,0.758,0.768,0.808,0.796,0.818,
     &    0.831,0.829,0.828,0.839,0.835,0.836,0.835,0.84,0.841/

      DATA SiO2qevir/0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,
     &    0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,
     &    0.001,0.002,0.002,0.002,0.003,0.004,0.005,0.006,0.013,0.02,
     &    0.05,0.128,0.293,0.42,0.916,1.619,2.623,3.627,3.902,2.67,
     &    1.907,2.66,1.916,2.334,2.343,2.097,2.195,2.177,2.064/

      DATA SiO2g0vir/0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,
     &    0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.004,
     &    0.004,0.005,0.005,0.007,0.012,0.016,0.021,0.028,0.048,0.064,
     &    0.113,0.202,0.376,0.507,0.678,0.756,0.813,0.843,0.845,0.76,
     &    0.655,0.846,0.835,0.876,0.882,0.892,0.91,0.923,0.933/

      DATA Mg2SiO4qevis/0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.328,
     &    0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.328,0.539,
     &    0.539,0.843,0.843,1.336,2.797,3.232,4.345,4.1,4.175,2.979,
     &    2.069,2.916,1.959,2.48,2.18,2.307,2.207,2.19,2.249,2.101,
     &    2.109,2.109,2.1,2.036,2.032,2.05,2.034,2.025,2.028/

      DATA Mg2SiO4g0vis/0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.202,
     &    0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.202,0.279,
     &    0.279,0.394,0.394,0.539,0.558,0.616,0.684,0.63,0.591,0.444,
     &    0.343,0.745,0.629,0.725,0.674,0.751,0.724,0.736,0.736,0.768,
     &    0.771,0.779,0.775,0.772,0.777,0.776,0.782,0.781,0.783/

      DATA Mg2SiO4qevir/0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,
     &    0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,
     &    0.0,0.0,0.0,0.0,0.001,0.002,0.004,0.007,0.021,0.037,
     &    0.112,0.32,0.774,1.205,2.406,3.811,4.201,3.577,1.868,2.634,
     &    2.069,2.576,2.585,2.375,2.093,2.085,2.213,2.157,2.044/

      DATA Mg2SiO4g0vir/0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,
     &    0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.004,
     &    0.004,0.006,0.006,0.008,0.013,0.017,0.023,0.031,0.053,0.071,
     &    0.124,0.225,0.438,0.575,0.598,0.713,0.723,0.621,0.424,0.74,
     &    0.712,0.768,0.734,0.769,0.758,0.774,0.804,0.793,0.806/

      DATA VOqevis/2.719,2.719,2.719,2.719,2.719,2.719,2.719,2.719,2.719,2.719,2.719,
     &    2.719,2.719,2.719,2.719,2.719,2.719,2.719,2.719,2.719,3.163,
     &    3.163,3.227,3.227,3.131,3.089,2.94,2.879,2.811,2.701,2.648,
     &    2.551,2.468,2.396,2.364,2.308,2.259,2.218,2.183,2.153,2.128,
     &    2.106,2.088,2.073,2.061,2.05,2.046,2.038,2.031,2.026/

      DATA VOg0vis/0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.244,
     &    0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.244,0.296,
     &    0.296,0.352,0.352,0.441,0.601,0.633,0.679,0.707,0.75,0.765,
     &    0.786,0.8,0.809,0.812,0.817,0.82,0.822,0.823,0.823,0.823,
     &    0.823,0.823,0.823,0.822,0.822,0.822,0.821,0.821,0.821/

      DATA VOqevir/0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,
     &    0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.012,
     &    0.012,0.015,0.015,0.018,0.028,0.037,0.051,0.073,0.175,0.293,
     &    0.965,5.264,4.207,3.897,1.896,3.204,2.567,2.794,2.576,2.437,
     &    2.337,2.289,2.24,2.202,2.17,2.156,2.131,2.109,2.092/

      DATA VOg0vir/0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,
     &    0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.006,0.008,
     &    0.008,0.01,0.01,0.014,0.025,0.033,0.043,0.058,0.105,0.143,
     &    0.292,0.447,0.263,0.446,0.362,0.702,0.585,0.779,0.778,0.791,
     &    0.803,0.812,0.815,0.818,0.819,0.82,0.82,0.821,0.821/

      DATA Niqevis/2.905,2.905,2.905,2.905,2.905,2.905,2.905,2.905,2.905,2.905,2.905,
     &    2.905,2.905,2.905,2.905,2.905,2.905,2.905,2.905,2.905,3.092,
     &    3.092,2.902,2.902,2.68,2.817,2.723,2.649,2.669,2.581,2.534,
     &    2.472,2.418,2.374,2.353,2.317,2.285,2.257,2.233,2.211,2.19,
     &    2.171,2.152,2.135,2.118,2.101,2.093,2.078,2.064,2.051/

      DATA Nig0vis/-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,
     &    -0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.079,-0.038,
     &    -0.038,0.031,0.031,0.147,0.353,0.369,0.423,0.457,0.499,0.514,
     &    0.533,0.546,0.554,0.557,0.559,0.561,0.56,0.56,0.558,0.557,
     &    0.555,0.552,0.55,0.547,0.545,0.544,0.541,0.539,0.537/

      DATA Niqevir/0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.023,
     &    0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.023,0.031,
     &    0.031,0.044,0.044,0.064,0.16,0.279,0.51,0.864,1.132,1.34,
     &    2.101,2.875,2.709,2.637,2.651,2.556,2.478,2.41,2.35,2.299,
     &    2.257,2.22,2.189,2.163,2.141,2.13,2.112,2.097,2.083/

      DATA Nig0vir/0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.027,
     &    0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.027,0.036,
     &    0.036,0.048,0.048,0.065,0.112,0.137,0.133,0.04,-0.194,-0.184,
     &    -0.111,-0.019,0.166,0.292,0.427,0.511,0.558,0.588,0.607,0.619,
     &    0.627,0.632,0.634,0.635,0.636,0.636,0.636,0.635,0.635/

      DATA Feqevis/3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.371,
     &    3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.371,3.366,
     &    3.366,3.149,3.149,3.017,3.093,2.968,2.933,2.887,2.774,2.729,
     &    2.632,2.552,2.481,2.449,2.389,2.337,2.29,2.248,2.211,2.179,
     &    2.15,2.125,2.103,2.085,2.069,2.063,2.051,2.041,2.033/

      DATA Feg0vis/0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.021,
     &    0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.021,0.07,
     &    0.07,0.15,0.15,0.273,0.446,0.473,0.526,0.552,0.594,0.611,
     &    0.63,0.643,0.651,0.653,0.655,0.656,0.655,0.654,0.652,0.65,
     &    0.648,0.647,0.645,0.643,0.642,0.641,0.64,0.639,0.638/

      DATA Feqevir/0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.025,
     &    0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.025,0.032,
     &    0.032,0.041,0.041,0.051,0.077,0.095,0.122,0.164,0.36,0.575,
     &    1.463,2.513,2.455,2.343,2.454,2.363,2.315,2.276,2.232,2.199,
     &    2.171,2.148,2.129,2.113,2.1,2.095,2.085,2.076,2.068/

      DATA Feg0vir/-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,
     &    -0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.089,-0.109,
     &    -0.109,-0.131,-0.131,-0.154,-0.196,-0.213,-0.227,-0.235,-0.237,-0.229,
     &    -0.192,-0.119,0.04,0.174,0.327,0.411,0.457,0.487,0.504,0.516,
     &    0.522,0.526,0.528,0.529,0.529,0.529,0.528,0.528,0.527/

      DATA CaTiO3qevis/1.133,1.133,1.133,1.133,1.133,1.133,1.133,1.133,1.133,1.133,1.133,
     &    1.133,1.133,1.133,1.133,1.133,1.133,1.133,1.133,1.133,2.283,
     &    2.283,5.459,5.459,4.456,4.635,3.273,1.821,1.564,3.973,3.141,
     &    3.15,2.447,2.171,2.193,2.487,2.237,2.286,2.174,2.252,2.145,
     &    2.079,2.092,2.044,2.058,2.052,2.041,2.039,2.032,2.026/

      DATA CaTiO3g0vis/0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.331,
     &    0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.331,0.492,
     &    0.492,0.465,0.465,0.315,0.419,0.2,0.149,0.155,0.617,0.644,
     &    0.515,0.341,0.465,0.53,0.639,0.634,0.656,0.638,0.693,0.696,
     &    0.706,0.732,0.745,0.769,0.792,0.801,0.822,0.838,0.85/

      DATA CaTiO3qevir/0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,
     &    0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,
     &    0.001,0.001,0.001,0.002,0.005,0.008,0.013,0.021,0.065,0.116,
     &    0.378,1.194,4.689,4.141,4.925,2.659,2.97,3.32,2.442,2.085,
     &    2.017,2.327,2.157,2.246,2.233,2.231,2.095,2.122,2.074/

      DATA CaTiO3g0vir/0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,
     &    0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.006,
     &    0.006,0.008,0.008,0.01,0.018,0.023,0.031,0.041,0.071,0.095,
     &    0.172,0.348,0.493,0.378,0.497,0.289,0.307,0.727,0.467,0.518,
     &    0.567,0.672,0.668,0.715,0.752,0.764,0.776,0.809,0.83/

      DATA Al2O3qevis/0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.352,
     &    0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.352,0.533,
     &    0.533,0.785,0.785,1.15,2.315,2.7,3.505,3.663,3.874,3.285,
     &    2.129,2.535,2.423,2.196,2.3,2.254,2.187,2.172,2.141,2.119,
     &    2.099,2.082,2.068,2.057,2.047,2.043,2.036,2.029,2.024/

      DATA Al2O3g0vis/0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.196,
     &    0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.196,0.269,
     &    0.269,0.378,0.378,0.52,0.61,0.648,0.727,0.718,0.729,0.707,
     &    0.587,0.798,0.868,0.851,0.895,0.92,0.93,0.937,0.94,0.941,
     &    0.942,0.942,0.942,0.942,0.942,0.942,0.942,0.942,0.942/

      DATA Al2O3qevir/0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,
     &    0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.006,
     &    0.006,0.006,0.006,0.008,0.011,0.013,0.016,0.02,0.036,0.051,
     &    0.115,0.272,0.596,0.863,1.784,2.876,3.828,3.767,2.605,1.986,
     &    2.741,2.091,2.256,2.23,2.139,2.15,2.132,2.12,2.093/

      DATA Al2O3g0vir/0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,
     &    0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.004,
     &    0.004,0.005,0.005,0.007,0.013,0.017,0.022,0.029,0.051,0.068,
     &    0.119,0.216,0.412,0.552,0.643,0.754,0.786,0.776,0.672,0.665,
     &    0.858,0.846,0.883,0.914,0.928,0.937,0.947,0.953,0.955/

      DATA CaSiO4qevis/0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.206,
     &    0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.206,0.337,
     &    0.337,0.522,0.522,0.782,1.869,2.271,3.0,3.549,4.072,3.969,
     &    2.496,2.131,3.122,2.253,2.589,2.385,2.416,2.057,2.044,2.101,
     &    2.129,2.066,2.099,2.067,2.038,2.054,2.05,2.021,2.028/

      DATA CaSiO4g0vis/0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.187,
     &    0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.187,0.255,
     &    0.255,0.354,0.354,0.49,0.62,0.629,0.712,0.725,0.736,0.724,
     &    0.595,0.492,0.743,0.76,0.793,0.773,0.79,0.765,0.773,0.794,
     &    0.811,0.794,0.812,0.808,0.815,0.819,0.82,0.819,0.823/

      DATA CaSiO4qevir/0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.012,
     &    0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.012,0.014,
     &    0.014,0.017,0.017,0.019,0.026,0.031,0.037,0.045,0.069,0.09,
     &    0.164,0.326,0.635,0.877,1.645,2.547,3.39,3.555,2.841,2.185,
     &    2.505,2.258,2.312,2.239,2.184,2.168,2.137,2.113,2.094/

      DATA CaSiO4g0vir/0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,
     &    0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.003,0.004,
     &    0.004,0.005,0.005,0.007,0.012,0.016,0.022,0.029,0.05,0.067,
     &    0.118,0.215,0.409,0.548,0.664,0.77,0.813,0.827,0.798,0.782,
     &    0.901,0.925,0.942,0.951,0.955,0.956,0.957,0.958,0.958/

      DATA KClpi0vis/0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99/

      DATA KClpi0vir/0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.168,
     &    0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.168,0.236,
     &    0.236,0.319,0.319,0.416,0.621,0.712,0.789,0.848,0.925,0.948,
     &    0.974,0.986,0.991,0.992,0.995,0.995,0.995,0.994,0.987,0.977,
     &    0.98,0.966,0.961,0.947,0.927,0.924,0.909,0.889,0.855/

      DATA ZnSpi0vis/0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.989,
     &    0.989,0.991,0.991,0.994,0.987,0.979,0.963,0.952,0.974,0.971,
     &    0.961,0.934,0.907,0.924,0.903,0.88,0.837,0.817,0.778,0.751,
     &    0.717,0.683,0.651,0.627,0.613,0.608,0.604,0.602,0.602/

      DATA ZnSpi0vir/0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.614,
     &    0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.614,0.707,
     &    0.707,0.786,0.786,0.848,0.927,0.95,0.966,0.977,0.989,0.992,
     &    0.996,0.997,0.997,0.998,0.996,0.99,0.991,0.988,0.975,0.978,
     &    0.97,0.957,0.951,0.952,0.936,0.929,0.906,0.876,0.86/

      DATA Na2Spi0vis/0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.929,
     &    0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.929,0.942,
     &    0.942,0.947,0.947,0.951,0.964,0.954,0.959,0.939,0.896,0.846,
     &    0.847,0.808,0.818,0.734,0.71,0.687,0.637,0.62,0.597,0.578,
     &    0.567,0.565,0.565,0.566,0.567,0.567,0.567,0.568,0.568/

      DATA Na2Spi0vir/0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.044,
     &    0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.044,0.066,
     &    0.066,0.097,0.097,0.141,0.273,0.362,0.46,0.56,0.737,0.804,
     &    0.893,0.937,0.951,0.957,0.964,0.959,0.918,0.832,0.848,0.826,
     &    0.814,0.772,0.732,0.665,0.632,0.632,0.6,0.577,0.566/

      DATA MnSpi0vis/0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,
     &    0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,0.999,
     &    0.999,1.0,1.0,0.999,0.996,0.996,0.998,0.999,0.997,0.995,
     &    0.995,0.993,0.993,0.99,0.979,0.987,0.985,0.967,0.969,0.962,
     &    0.956,0.945,0.931,0.908,0.888,0.872,0.839,0.808,0.773/

      DATA MnSpi0vir/0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.996,
     &    0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.996,0.998,
     &    0.998,0.998,0.998,0.999,1.0,1.0,1.0,1.0,0.99,0.99,
     &    0.99,0.99,0.99,0.99,1.0,1.0,0.99,1.0,1.0,1.0,
     &    1.0,1.0,1.0,0.999,0.999,0.999,0.999,0.999,0.998/

      DATA Crpi0vis/0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.661,
     &    0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.661,0.694,
     &    0.694,0.707,0.707,0.707,0.72,0.73,0.732,0.739,0.748,0.751,
     &    0.759,0.765,0.77,0.772,0.776,0.78,0.783,0.786,0.789,0.792,
     &    0.794,0.797,0.799,0.801,0.803,0.804,0.805,0.807,0.808/

      DATA Crpi0vir/0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.032,
     &    0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.032,0.045,
     &    0.045,0.065,0.065,0.095,0.209,0.301,0.415,0.541,0.761,0.835,
     &    0.917,0.948,0.956,0.955,0.958,0.96,0.962,0.963,0.964,0.965,
     &    0.965,0.966,0.966,0.966,0.967,0.967,0.967,0.967,0.967/

      DATA SiO2pi0vis/0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99/

      DATA SiO2pi0vir/0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,
     &    0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.038,
     &    0.038,0.057,0.057,0.085,0.176,0.244,0.327,0.422,0.618,0.705,
     &    0.833,0.906,0.941,0.95,0.965,0.973,0.977,0.977,0.971,0.946,
     &    0.894,0.913,0.852,0.851,0.813,0.782,0.752,0.704,0.646/

      DATA Mg2SiO4pi0vis/0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,1.0,1.0,1.0,1.0,1.0,1.0,0.999/

      DATA Mg2SiO4pi0vir/0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.509,
     &    0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.509,0.613,
     &    0.613,0.706,0.706,0.785,0.894,0.927,0.95,0.966,0.984,0.989,
     &    0.995,0.997,0.998,0.998,0.999,0.999,0.999,0.997,0.994,0.994,
     &    0.991,0.993,0.988,0.984,0.98,0.978,0.972,0.96,0.952/

      DATA VOpi0vis/0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.405,
     &    0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.405,0.451,
     &    0.451,0.481,0.481,0.481,0.476,0.479,0.484,0.497,0.519,0.528,
     &    0.545,0.56,0.573,0.578,0.588,0.596,0.603,0.609,0.613,0.617,
     &    0.62,0.622,0.624,0.625,0.626,0.626,0.627,0.628,0.628/

      DATA VOpi0vir/0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.031,
     &    0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.031,0.046,
     &    0.046,0.069,0.069,0.1,0.2,0.27,0.353,0.443,0.614,0.682,
     &    0.757,0.738,0.806,0.618,0.402,0.636,0.554,0.596,0.583,0.579,
     &    0.58,0.589,0.596,0.603,0.608,0.61,0.614,0.618,0.62/

      DATA Nipi0vis/0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.884,
     &    0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.884,0.899,
     &    0.899,0.905,0.905,0.904,0.907,0.911,0.91,0.913,0.915,0.916,
     &    0.918,0.919,0.92,0.921,0.922,0.922,0.923,0.923,0.924,0.924,
     &    0.925,0.926,0.926,0.927,0.928,0.929,0.93,0.931,0.932/

      DATA Nipi0vir/0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,
     &    0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.026,0.035,
     &    0.035,0.044,0.044,0.054,0.07,0.075,0.078,0.092,0.238,0.33,
     &    0.506,0.623,0.662,0.665,0.689,0.702,0.716,0.727,0.736,0.743,
     &    0.749,0.754,0.759,0.762,0.766,0.767,0.769,0.772,0.773/

      DATA Fepi0vis/0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.618,
     &    0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.618,0.653,
     &    0.653,0.666,0.666,0.663,0.681,0.691,0.692,0.702,0.712,0.715,
     &    0.724,0.731,0.737,0.74,0.746,0.75,0.755,0.759,0.763,0.767,
     &    0.77,0.774,0.776,0.779,0.781,0.782,0.783,0.784,0.785/

      DATA Fepi0vir/0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.028,
     &    0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.028,0.038,
     &    0.038,0.054,0.054,0.077,0.166,0.241,0.341,0.46,0.694,0.782,
     &    0.887,0.928,0.938,0.937,0.942,0.944,0.946,0.948,0.949,0.95,
     &    0.951,0.952,0.952,0.953,0.953,0.953,0.954,0.954,0.954/

      DATA CaTiO3pi0vis/0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,
     &    0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,0.997,
     &    0.997,0.997,0.997,0.998,0.996,0.995,0.989,0.982,0.968,0.992,
     &    0.976,0.946,0.963,0.957,0.97,0.959,0.938,0.928,0.915,0.893,
     &    0.864,0.835,0.799,0.764,0.726,0.706,0.672,0.643,0.622/

      DATA CaTiO3pi0vir/0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.242,
     &    0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.242,0.326,
     &    0.326,0.424,0.424,0.527,0.718,0.793,0.851,0.895,0.948,0.963,
     &    0.98,0.986,0.988,0.991,0.985,0.968,0.892,0.968,0.919,0.896,
     &    0.888,0.893,0.844,0.827,0.798,0.789,0.737,0.705,0.665/

      DATA Al2O3pi0vis/0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.721,
     &    0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.721,0.771,
     &    0.771,0.804,0.804,0.823,0.87,0.874,0.874,0.875,0.832,0.797,
     &    0.63,0.639,0.613,0.564,0.562,0.548,0.535,0.537,0.54,0.543,
     &    0.546,0.548,0.55,0.551,0.552,0.552,0.553,0.553,0.553/

      DATA Al2O3pi0vir/0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.011,
     &    0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.011,0.016,
     &    0.016,0.025,0.025,0.037,0.082,0.118,0.168,0.233,0.402,0.497,
     &    0.673,0.796,0.86,0.876,0.912,0.921,0.922,0.897,0.811,0.707,
     &    0.746,0.645,0.633,0.598,0.56,0.556,0.544,0.541,0.539/

      DATA CaSiO4pi0vis/0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,
     &    0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99,0.99/

      DATA CaSiO4pi0vir/0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,
     &    0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.004,0.006,
     &    0.006,0.009,0.009,0.013,0.03,0.044,0.065,0.094,0.187,0.253,
     &    0.413,0.572,0.68,0.712,0.781,0.808,0.817,0.788,0.686,0.534,
     &    0.573,0.523,0.535,0.524,0.523,0.525,0.529,0.533,0.536/


      Tconds(1:51,1)=TconKCl
      Tconds(1:51,2)=TconZnS
      Tconds(1:51,3)=TconNa2S
      Tconds(1:51,4)=TconMnS
      !Tconds(1:51,5)=Tconcr
      Tconds(1:51,5)=TconCr
      Tconds(1:51,6)=TconSiO2
      Tconds(1:51,7)=TconMg2SiO4
      Tconds(1:51,8)=TconVO
      Tconds(1:51,9)=TconNi
      Tconds(1:51,10)=TconFe
      Tconds(1:51,11)=TconCaSiO4
      Tconds(1:51,12)=TconCaTiO3
      Tconds(1:51,13)=TconAl2O3

      g0vis(1:50,1)=KClg0vis
      g0vis(1:50,2)=ZnSg0vis
      g0vis(1:50,3)=Na2Sg0vis
      g0vis(1:50,4)=MnSg0visf
      g0vis(1:50,5)=crg0vis
      g0vis(1:50,6)=SiO2g0vis
      g0vis(1:50,7)=Mg2SiO4g0vis
      g0vis(1:50,8)=VOg0vis
      g0vis(1:50,9)=Nig0vis
      g0vis(1:50,10)=Feg0vis
      g0vis(1:50,11)=CaSiO4g0vis
      g0vis(1:50,12)=CaTiO3g0vis
      g0vis(1:50,13)=Al2O3g0vis

      g0ir(1:50,1)=KClg0vir
      g0ir(1:50,2)=ZnSg0vir
      g0ir(1:50,3)=Na2Sg0vir
      g0ir(1:50,4)=MnSg0vir
      g0ir(1:50,5)=crg0vir
      g0ir(1:50,6)=SiO2g0vir
      g0ir(1:50,7)=Mg2SiO4g0vir
      g0ir(1:50,8)=VOg0vir
      g0ir(1:50,9)=Nig0vir
      g0ir(1:50,10)=Feg0vir
      g0ir(1:50,11)=CaSiO4g0vir
      g0ir(1:50,12)=CaTiO3g0vir
      g0ir(1:50,13)=Al2O3g0vir

      pi0vis(1:50,1)=KClpi0vis
      pi0vis(1:50,2)=ZnSpi0vis
      pi0vis(1:50,3)=Na2Spi0vis
      pi0vis(1:50,4)=MnSpi0vis
      pi0vis(1:50,5)=crpi0vis
      pi0vis(1:50,6)=SiO2pi0vis
      pi0vis(1:50,7)=Mg2SiO4pi0vis
      pi0vis(1:50,8)=VOpi0vis
      pi0vis(1:50,9)=Nipi0vis
      pi0vis(1:50,10)=Fepi0vis
      pi0vis(1:50,11)=CaSiO4pi0vis
      pi0vis(1:50,12)=CaTiO3pi0vis
      pi0vis(1:50,13)=Al2O3pi0vis

      pi0ir(1:50,1)=KClpi0vir
      pi0ir(1:50,2)=ZnSpi0vir
      pi0ir(1:50,3)=Na2Spi0vir
      pi0ir(1:50,4)=MnSpi0vir
      pi0ir(1:50,5)=crpi0vir
      pi0ir(1:50,6)=SiO2pi0vir
      pi0ir(1:50,7)=Mg2SiO4pi0vir
      pi0ir(1:50,8)=VOpi0vir
      pi0ir(1:50,9)=Nipi0vir
      pi0ir(1:50,10)=Fepi0vir
      pi0ir(1:50,11)=CaSiO4pi0vir
      pi0ir(1:50,12)=CaTiO3pi0vir
      pi0ir(1:50,13)=Al2O3pi0vir

      qevis(1:50,1)=KClqevis
      qevis(1:50,2)=ZnSqevis
      qevis(1:50,3)=Na2Sqevis
      qevis(1:50,4)=MnSqevis
      qevis(1:50,5)=crqevis
      qevis(1:50,6)=SiO2qevis
      qevis(1:50,7)=Mg2SiO4qevis
      qevis(1:50,8)=VOqevis
      qevis(1:50,9)=Niqevis
      qevis(1:50,10)=Feqevis
      qevis(1:50,11)=CaSiO4qevis
      qevis(1:50,12)=CaTiO3qevis
      qevis(1:50,13)=Al2O3qevis

      qeir(1:50,1)=KClqevir
      qeir(1:50,2)=ZnSqevir
      qeir(1:50,3)=Na2Sqevir
      qeir(1:50,4)=MnSqevir
      qeir(1:50,5)=crqevir
      qeir(1:50,6)=SiO2qevir
      qeir(1:50,7)=Mg2SiO4qevir
      qeir(1:50,8)=VOqevir
      qeir(1:50,9)=Niqevir
      qeir(1:50,10)=Feqevir
      qeir(1:50,11)=CaSiO4qevir
      qeir(1:50,12)=CaTiO3qevir
      qeir(1:50,13)=Al2O3qevir


      Do 200  I         = 1,NCLOUD
       DO 180  J          =   1,NLAYER -1
        CONDFACT(J,I)     =min(max((Tconds(J,I)-TT(J))/10.,0.0),1.0)
        TAUFACT= DPG(J)*10.*molef(I)*3./4./rps(J)/density(I)*fmolw(I)*CONDFACT(J,I)*MTLX*CORFACT(J)
        TAUAERSW(J,I)     =TAUFACT*qevis(J,I)
        TAUAERLW(J,I)     =TAUFACT*qeir(J,I)
        CLOUDLOC(J,I)     =NINT(CONDFACT(J,I))*J
        ZEROARR(J)        =0.

180   CONTINUE
!       uncomment this section for compact cloud
        BASELEV         = MAXVAL(CLOUDLOC(1:50,I),1)
        TOPLEV          = max(BASELEV-AERLAYERS,0)  !changed from 1 to 0
        DO 185  J       = 1,TOPLEV
          TAUAERSW(J,I)       = 0.
          TAUAERLW(J,I)       = 0.

185   CONTINUE
         TAUAERSW(TOPLEV+2,I)= TAUAERSW(TOPLEV+2,I)*0.367879 !i.e.e(-2)
         TAUAERLW(TOPLEV+2,I)= TAUAERLW(TOPLEV+2,I)*0.367879
         TAUAERSW(TOPLEV+1,I)= TAUAERSW(TOPLEV+1,I)*0.135335 !i.e.e(-1)
         TAUAERLW(TOPLEV+1,I)= TAUAERLW(TOPLEV+1,I)*0.135335
186   CONTINUE
200   CONTINUE





! SW AT STANDARD VERTICAL RESOLUTION
      DO 220    J     =  1,NLAYER
       TAUAER(1,J)    = SUM(TAUAERSW(J,1:13))
       WOL(1,J)       = SUM(TAUAERSW(J,1:13)/(TAUAER(1,J)+1e-8)* PI0vis(J,1:13))
       GOL(1,J)       = SUM(TAUAERSW(J,1:13)/(TAUAER(1,J)+1e-8)* g0vis(J,1:13))
220   CONTINUE

! LW AT 2X VERTICAL RESOLUTION (FOR PERFORMANCE).
      k         =  1
      DO 240  J          =   1,NDBL,2
      JJ         = J

      TAUAER(2,JJ)       = SUM(TAUAERLW(K,1:13))
      WOL(2,JJ)  = SUM(TAUAERLW(K,1:13)/(SUM(TAUAERLW(K,1:13))+1e-8) * PI0ir(k,1:13))
      GOL(2,JJ)  = SUM(TAUAERLW(K,1:13)/(SUM(TAUAERLW(K,1:13))+1e-8) * g0ir(k,1:13))

      JJ          = J+1
      TAUAER(2,JJ)       = TAUAER(2,JJ-1)
      WOL(2,JJ)          = WOL(2,JJ-1)
      GOL(2,JJ)          = GOL(2,JJ-1)

      k = k+1
240   CONTINUE

      ! Fix it for N number of channels so it doesn't break
      DO L = LLS+1, NSOLP
          TAUAER(L,:) = TAUAER(1,:)
          WOL(L,:)    = WOL(1,:)
          GOL(L,:)    = GOL(1,:)
      END DO

      DO L = LLS+1, NSOLP
          TAUAER(L,:) = TAUAER(2,:)
          WOL(L,:)    = WOL(2,:)
          GOL(L,:)    = GOL(2,:)
      END DO

      iradgas = 1
      DO J = 1,NLAYER
          j1 = max(1, j-1)

!         First the solar at standard resolution
          DO L = solar_calculation_indexer,NSOLP
              TAUL(L,J) = TAUGAS(L,J)+TAURAY(L,J)+TAUAER(L,J)

              if(TAUL(L,J) .lt. 1d-6 ) then
                  TAUL(L,J) = 1d-6
              endif

              utauL(L,j)  = TAUL(L,J)
              WOT = (TAURAY(L,J)+TAUAER(L,J)*WOL(L,J))/TAUL(L,J)


              WOT       = min(1.-1d-6,WOT)
              uw0(L,j)  = WOT
              DENOM     = (TAURAY(L,J) + TAUAER(L,J) * WOL(L,J))

              if( DENOM .LE. 1d-6 ) then
                  DENOM = 1d-6
              endif

              if( DENOM .GT. 1d-6 ) then
                  GOT = ( GOL(L,J)* WOL(L,J)*TAUAER(L,J) ) / DENOM
              else
                  GOT = 0.
              endif

              if (iradgas.eq.0) then
                  GOT = goL(L,j)
              endif

              ug0(L,j)    = GOT
              uOPD(L,J)   = uOPD(L,J1)+uTAUL(L,J)


              TAUL(L,J)   = TAUL(L,J) * (1.-WOT*(GOT*GOT))
              W0(L,J)     = (1.-(GOT*GOT))*WOT/(1.-WOT*(GOT*GOT))
              G0(L,J)     = GOT/(1.+GOT)
              OPD(L,J)    = 0.0
              OPD(L,J)    = OPD(L,J1)+TAUL(L,J)


!             HERE'S WHERE YOU CAN HARDWIRE VALUES
              if( taul(L,j) .lt. 0.) then
                  write(*,*) 'ERROR! The VISIBLE layer optical depth is less than 0:', taul(L,j)
                  stop
              endif
          END DO
      END DO

!     NOW AGAIN FOR THE IR
      DO J = 1,NDBL
          j1 = max( 1, j-1 )
          DO L = NSOLP+1,NTOTAL
              TAUL(L,J) = TAUGAS(L,J)+TAURAY(L,J)+TAUAER(L,J)


              if (iradgas.eq.0) then
                  tauL(L,j) = tauaer(L,j)
              endif

              if( TAUL(L,J) .lt. 1d-6 ) then
                  TAUL(L,J) = 1d-6
              endif

              utauL(L,j)  = TAUL(L,J)
              WOT         = (TAURAY(L,J)+TAUAER(L,J)*WOL(L,J))/TAUL(L,J)
              if (iradgas.eq.0) then
                  wot = woL(L,j)
              endif

              WOT         = min(1.-1d-6,WOT)
              uw0(L,j)    = WOT
              DENOM       = (TAURAY(L,J)+ TAUAER(L,J)*WOL(L,J))

              if( DENOM .LE. 1d-6 ) then
                  DENOM = 1d-6
              endif

              if( DENOM .GT. 1d-6 ) then
                  GOT = ( GOL(L,J)* WOL(L,J)*TAUAER(L,J) ) / DENOM
              else
                  GOT = 0.
              endif

              if (iradgas.eq.0) then
                  GOT = goL(L,j)
              endif

              ug0(L,j)    = GOT
              uOPD(L,J)   = 0.0
              uOPD(L,J)   = uOPD(L,J1)+uTAUL(L,J)

              IF (.TRUE.) THEN
                  TAUL(L,J)   = TAUL(L,J) * (1.-WOT*(GOT*GOT))
                  W0(L,J)     = (1.-(GOT*GOT))*WOT/(1.-WOT*(GOT*GOT))
                  G0(L,J)     = GOT/(1.+GOT)
                  OPD(L,J)    = 0.0
                  OPD(L,J)    = OPD(L,J1)+TAUL(L,J)
              ELSE
                  W0(L,J)= uw0(L,J)
                  G0(L,J)= ug0(L,J)
                  TAUL(L,J)= utaul(L,J)
                  OPD(L,J)= uOPD(L,J)
             END IF


             if(taul(L,j) .lt. 0.) then
                 write(*,*) 'ERROR! The IR layer optical depth is less than 0:', taul(L,j)
                 stop
             endif

          END DO

          DO I = 1,NGAUSS
              DO L = NSOLP+1,NTOTAL
                  Y3(L,I,J) =   EXP(-TAUL(L,J)/GANGLE(I))
              END DO
          END DO
      END DO

      RETURN
      END
