      SUBROUTINE OPPRMULTI
!
!     **************************************************************
!     *  Purpose             :  CaLculates optical properties      *
!     *                         such as single scattering albedo,  *
!     *                         asymmetry parameter, etc.          *
!     *                         This routine is case dependent and *
!     *                         wiLL have to be repLaced by the    *
!     *                         user.                              *
!     *  Subroutines Called  :  None                               *
!     *  Input               :  PAH2O, RDH2O, CO2, O3, ETC         *
!     *  Output              :  TAUL, W0, G0, OPD, Y3              *
!     * ************************************************************
!
      include 'rcommons.h'
!     W0(NWAVE,NLAYER) : SINGLE SCATTERING ALBEDO *** delta scaled ***
!     G0(NWAVE,NLAYER) : ASYMMETRY PARAMETER *** delta scaled ***
!     OPD(NWAVE,NLAYER): cumulative OPTICAL DEPTH *** delta scaled ***
!     SFL(NWAVE)       : SOLAR FLUX
!    uW0(NWAVE,NLAYER)  : unscaled SINGLE SCATTERING ALBEDO 
!    uG0(NWAVE,NLAYER)  : unscaled ASYMMETRY PARAMETER 
!    uTAUL(NWAVE,NLAYER): unscaled OPTICAL DEPTH of layer
!
!     ASSUME THAT P IS SAME ON ALL SIGMA LEVELS. IF PSURFACE
!     VARIES A LOT, THEN WE MAY NEED TO CALCULATE TAUO3,
!     TAUCO2, TAUO2 FOR EACH POINT.
!
!     NOTE : THE TOP LAYER IS A DUMMY. IT CONTAINS A DEFINED GAS
!            AMOUNT. DIFFERENT MODELS WILL REQUIRE DIFFERENT
!            TREATMENT OF THIS.
!     CALCULATE TOTAL OPTICAL DEPTH INCLUDING GASES. THEN
!     GIVEN THE AEROSOL OPTICAL DEPTHS AND CLOUD OPTICAL DEPTHS,
!     CALCULATE FINAL OPTICAL PROPERTIES. WE USE A DELTA
!     TWO STREAM APPROACH TO FIND W0, SINGLE SCATTERING ALBEDO,
!     G0, ASYMMMETRY PARAMETER, TAUL, LAYER OPTICAL DEPTH,
!     OPD, CUMULATIVE OPTICAL DEPTH TO BASE OF LAYER.
!     open( 23, file='tau.dat', form='formatted', status='unknown' )   
!     write(23,*) nlayer, ntotal
!
!   NOTE: THIS IS DOUBLE GRAY SPECIFIC; WOULD REQUIRE GENERALIZATION

!   Simple cloud test:
      REAL TCONKCL(NL+1)
      REAL KCLQEVIS(NL),KCLG0VIS(NL),KCLPI0VIS(NL)
      REAL KCLQEVIR(NL),KCLG0VIR(NL),KCLPI0VIR(NL)
      REAL TCONZNS(NL+1)
      REAL ZNSQEVIS(NL),ZNSG0VIS(NL),ZNSPI0VIS(NL)
      REAL ZNSQEVIR(NL),ZNSG0VIR(NL),ZNSPI0VIR(NL)
      REAL TCONNA2S(NL+1)
      REAL NA2SQEVIS(NL),NA2SG0VIS(NL),NA2SPI0VIS(NL)
      REAL NA2SQEVIR(NL),NA2SG0VIR(NL),NA2SPI0VIR(NL)
      REAL TCONMnS(NL+1)
      REAL MnSQEVIS(NL),MnSG0VIS(NL),MnSPI0VIS(NL)
      REAL MnsQEVIR(NL),MnSG0VIR(NL),MnSPI0VIR(NL)
      REAL TCONCr2O3(NL+1)
      REAL Cr2O3QEVIS(NL),Cr2O3G0VIS(NL),Cr2O3PI0VIS(NL)
      REAL Cr2O3QEVIR(NL),Cr2O3G0VIR(NL),Cr2O3PI0VIR(NL)
      REAL TCONSiO2(NL+1)
      REAL SiO2QEVIS(NL),SiO2G0VIS(NL),SiO2PI0VIS(NL)
      REAL SiO2QEVIR(NL),SiO2G0VIR(NL),SiO2PI0VIR(NL)
      REAL TCONMg2SiO4(NL+1)
      REAL Mg2SiO4QEVIS(NL),Mg2SiO4G0VIS(NL),Mg2SiO4PI0VIS(NL)
      REAL Mg2SiO4QEVIR(NL),Mg2SiO4G0VIR(NL),Mg2SiO4PI0VIR(NL)
      REAL TCONVO(NL+1)
      REAL VOQEVIS(NL),VOG0VIS(NL),VOPI0VIS(NL)
      REAL VOQEVIR(NL),VOG0VIR(NL),VOPI0VIR(NL)
      REAL TCONNi(NL+1)
      REAL NiQEVIS(NL),NiG0VIS(NL),NiPI0VIS(NL)
      REAL NiQEVIR(NL),NiG0VIR(NL),NiPI0VIR(NL)
      REAL TCONFe(NL+1)
      REAL FeQEVIS(NL),FeG0VIS(NL),FePI0VIS(NL)
      REAL FeQEVIR(NL),FeG0VIR(NL),FePI0VIR(NL)
      REAL TCONCa2SiO4(NL+1)
      REAL Ca2SiO4QEVIS(NL),Ca2SiO4G0VIS(NL),Ca2SiO4PI0VIS(NL)
      REAL Ca2SiO4QEVIR(NL),Ca2SiO4G0VIR(NL),Ca2SiO4PI0VIR(NL)
      REAL TCONCaTiO3(NL+1)
      REAL CaTiO3QEVIS(NL),CaTiO3G0VIS(NL),CaTiO3PI0VIS(NL)
      REAL CaTiO3QEVIR(NL),CaTiO3G0VIR(NL),CaTiO3PI0VIR(NL)
      REAL TCONAL2O3(NL+1),TCONDS(NL+1,13)
      REAL Al2O3QEVIS(NL),Al2O3G0VIS(NL),Al2O3PI0VIS(NL)
      REAL Al2O3QEVIR(NL),Al2O3G0VIR(NL),Al2O3PI0VIR(NL)
      REAL MOLEF(13),DENSITY(13),RPS(NL),TAUFACT,FMOLW(13)
      REAL QEVIS(NL+1,13),PI0VIS(NL+1,13),G0VIS(NL+1,13)
      REAL QEIR(NL+1,13),PI0IR(NL+1,13),G0IR(NL+1,13)
      REAL CONDFACT(NL+1,13),TAUAERSW(NL+1,13),TAUAERLW(NL+1,13)
      REAL CLOUDLOC(NL+1,13),ZEROARR(NL+1),CORFACT(NL+1)
      INTEGER K,JJ,J,NCLOUD,BASELEV,TOPLEV
!             COMMON/CLOUDY/AEROSOLMODEL,AERTOTTAU,CLOUDBASE,
!     &   CLOUDTOP,CLDFRCT,AERHFRAC,PI0AERSW,ASYMSW,EXTFACTLW,PI0AERLW,
!     &   ASYMLW,DELTASCALE,SIG_AREA,PHI_LON,TAUAEROSOL,AEROPROF,
!     &   MAXTAU,MAXTAULOC,TCON,AEROSOLCOMP,MTLX,MOLEF,AERLAYERS
!cloudspecies=['KCl','ZnS','Na2S','MnS','Cr2O3','SiO2','Mg2SiO4','VO','Ni','Fe','Ca2SiO4','CaTiO3','Al2O3']
      DATA NCLOUD/13/
!      DATA molefrac/1.23e-07, 4.06e-08,9.35e-07,3.11e-07,4.4e-07,
!     &             3.26e-05, 1.745e-05,9.56e-09,1.61e-06,2.94e-05,
!     &             9.95e-07,7.83e-08,1.385e-06/

      DATA   DENSITY/1.98e3,4.09e3,1.86e3,4.0e3,5.22e3,2.65e3,3.27e3,
     &                5.76e3,8.9e3, 7.9e3,3.34e3,3.98e3,3.95e3/

      DATA   FMOLW/31.59,41.30,33.07,36.87,64.40,25.46,59.61,28.37,
     &                  24.87, 23.66, 72.99, 50.83, 43.20  /

      DATA   CORFACT/0.005,0.018,0.050,0.135,.367,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000,1.000,1.000,1.000,1.000,1.000,
     &              1.000,1.000,1.000/

!    KCl
      DATA   TconKCl /617.032,621.573,626.038,630.552,635.053, 639.555,
     &         644.050,648.556,653.049,657.552,662.043,666.609,671.436,
     &         676.532,681.879,687.233,692.462,697.665,702.916,708.306,
     &         713.767,719.366,725.024,730.775,736.460,742.266,748.065,
     &        753.932,759.779,765.571, 771.346,777.201,783.301,789.715,
     &         796.379,803.117,809.863,816.737,823.798,831.052,838.426,
     &         845.980,853.873,862.074,870.494,878.913,887.351,895.768,
     &           904.198,912.867,917.385/

!ZnS
      DATA   TconZnS /708.296,712.010,716.704,719.507,722.309,727.329,
     &                730.718,736.323,739.126,744.731,747.534,753.139,
     &                755.942,761.547,764.350,769.955,772.758,778.363,
     &                783.969,788.079,792.377,797.982,803.587,806.390, 
     &                811.995,815.183,823.206,828.812,834.364,840.022, 
     &                845.628,851.233,856.839,862.444,868.049,873.655,
     &                879.260,884.865,890.471,896.076,901.682,907.287,
     &                915.695,921.897,929.708,936.547,943.722,949.327,
     &                955.732,963.063, 966.143/

!    Na2S
      DATA   TconNa2S /776.182,781.957,787.715,793.430,799.135,804.761,
     &              810.359, 815.868, 821.297, 826.731, 832.157,837.761,
     &              843.767,850.179,856.911,863.688,870.458,877.165,
     &              884.006, 890.930,897.948, 905.112,912.216,919.374,
     &              926.464,933.659,940.930,948.253,955.902,963.944,
     &          972.372,980.941,989.400,998.113,1007.19,1016.45,1025.51,
     &          1035.47,1044.52,1054.07,1063.67,1073.49,1083.32,1093.15,
     &              1103.16,1113.41,1123.84,1134.53,1145.92,1158.12,
     &              1164.38/


!     MnS
      DATA TCONMnS /1113.43, 1120.07,1126.64,1133.21,1139.9,1146.46,
     &        1153.15,  1159.65, 1166.25, 1173.01, 1180.09, 1187.73,
     &        1194.69, 1202.12, 1209.26, 1216.50, 1223.92, 1231.43,
     &       1239.19, 1247.17, 1255.39,1263.78, 1272.32,1281.40,
     &        1289.69, 1297.76, 1306.00, 1315.24, 1324.18, 1333.27,
     &        1342.44, 1351.39, 1360.54, 1369.99, 1379.72, 1389.42,
     &        1399.22, 1409.04,  1418.99,1428.77, 1438.60, 1449.11,
     &        1459.19, 1469.78, 1481.06, 1492.70, 1504.21, 1515.49,
     &            1527.84,1540.17,1545.90/

!    Cr2O3
      DATA   TconCr2O3 /1213.17,1219.05,1224.98,1231.07,1237.15,1243.21,
     &        1249.26,1255.35,1261.51,1267.83,1274.22,1280.63,1287.04,
     &       1293.56,1300.89,1309.34,1318.81,1329.04,1339.04,1349.79,
     &       1361.13,1373.13,1385.33,1397.48,1409.69,1421.78,1434.01,
     &      1446.16,1458.55,1471.19,1483.84,1496.49,1508.99,1522.14,
     &      1536.54,1552.17,1568.58,1585.09,1601.61,1618.14,1634.62,
     &      1651.02,1667.41,1683.80,1700.20,1716.57,1732.89,1749.26,
     &             1765.73,1783.15,1792.19/


!    SiO2
      DATA TCONSiO2 /1334.63,1342.58,1350.30,1358.48,1366.64,1374.85,
     &             1383.15,1391.59,1400.10,1408.68, 1417.25,1425.87,
     &             1434.53, 1443.14, 1451.71,1460.28,1468.90,1477.44,
     &             1486.12,1494.77,1503.91,1513.72 ,1524.07, 1534.57,
     &             1544.98,1555.25, 1565.35,1575.40, 1585.44,1595.55,
     &             1606.04,1617.06, 1628.55,1640.25,1651.98, 1664.07,
     &             1676.82,1689.97,1703.53, 1717.16, 1731.36, 1746.01,
     &             1761.10,1776.94, 1793.70,1811.36,1829.60, 1848.37,
     &             1867.54, 1887.00, 1896.46/

!    MgSiO3
!      DATA   TCONMgSiO3 /1307.11,1314.43,1321.68,1329.11,1336.79, 
!     &             1344.72,1352.04,1359.52,1367.46,1375.60,1383.27,
!     &             1391.60,1400.24,1408.51,1416.97,1425.28,1434.14,
!     &             1442.49,1451.31,1460.37,1469.43,1478.40,1487.67, 
!     &             1497.14,1507.25,1517.04,1527.28,1537.29,1546.58,
!     &             1556.41,1567.50,1578.63,1588.50,1598.45,1609.41,
!     &             1620.62,1631.41,1642.37,1654.32,1666.68,1678.34,
!     &             1689.61,1702.01,1715.51,1727.89,1739.21,1751.75, 
!     &             1765.34, 1778.58,1790.56,1796.07/     

!    Mg2SiO4
      DATA   TCONMg2SiO4 /1370.00,1378.31,1386.62,1395.03,1403.56,
     &           1412.29,
     &           1421.17, 1430.18, 1439.17, 1448.16, 1457.24,1466.52,
     &           1475.94,1485.57, 1495.23, 1505.09, 1515.04, 1525.21,
     &           1535.33,1545.80, 1556.37, 1567.12,1578.02, 1589.13,
     &           1600.29, 1611.67,1623.20, 1634.84,1646.61,1658.58,
     &           1670.74, 1683.03, 1695.59, 1708.44,1721.29,1734.41,
     &           1747.86, 1761.64, 1775.79, 1789.95, 1804.36,1819.11,
     &           1834.34, 1850.41, 1867.40, 1885.24,1903.85,1923.11,
     &           1943.09, 1963.67, 1974.17/
    
!    VO
      DATA TconVO/ 1363.07,1371.53, 1379.98, 1389.36,1399.69,1409.65,
     &            1419.40, 1429.94, 1439.11,1450.21, 1458.82,1470.07, 
     &       1481.33,1492.58,1503.61,1513.72,1526.34,1536.53,1547.03,
     &              1557.31,1569.87,1580.06,1591.07, 1603.14,1616.05,
     &          1627.63, 1639.06, 1652.94, 1664.91, 1677.84, 1690.74, 
     &             1703.56,1716.58,1729.50, 1742.92,1756.97, 1771.03, 
     &            1783.97, 1796.90,1810.39, 1824.44,1838.46, 1852.55, 
     &           1867.09, 1880.66, 1897.51,1914.24, 1929.95, 1945.67, 
     &               1964.18,1972.03/

!    Ni
      DATA  TconNi/ 1315.67, 1323.99,1333.24,1343.43,1353.31,1363.35,
     &      1373.31,1383.34,1393.43,1403.31, 1412.86,1421.18,1432.30,
     &      1443.43,1454.55,1465.97,1478.76,1491.77,1504.48, 1515.78,
     &      1529.72,1540.84,1554.77, 1568.23,1580.96,1593.81,1607.69,
     &      1622.14,1635.56,1650.51,1666.23,1681.67,1697.25,1713.65,
     &      1728.42,1746.81,1766.68,1786.23,1800.17,1817.54,1838.73,
     &      1857.11,1878.31, 1896.69,1917.47,1936.26,1957.45,1973.04,
     &      1994.22, 2018.22, 2028.81/

!    Fe
      DATA   TCONFe /1362.14,1373.43, 1384.60,1395.83, 1407.00,1418.26,
     &              1430.00,1442.48, 1455.61, 1469.10, 1482.58,1496.08,
     &              1509.58,1523.08,1536.57,1550.07,1563.57,1577.13,
     &              1590.57,1604.74,1619.69, 1635.41, 1651.59, 1667.75,
     &             1684.03,1700.80, 1718.31, 1736.60, 1755.27, 1773.98,
     &             1792.93, 1812.32,1832.10, 1852.28,1872.54, 1892.90,
     &             1913.24, 1934.27, 1956.41,1978.37, 2008.05, 2030.80,
     &             2051.13, 2081.89, 2103.84, 2132.13,2157.98, 2190.91,
     &              2221.92, 2247.77, 2263.48/    

!    Ca2SiO4
      DATA  TconCa2SiO4/1508.24,1518.14,1527.48,1536.15,1544.81,1556.36,
     &      1565.02, 1573.68, 1585.23, 1593.89, 1604.95,1614.10,1625.65,
     &     1634.31,1645.86, 1656.04, 1666.07, 1677.62,1689.17, 1700.23,
     &      1712.27,1722.50, 1735.37,1746.92,1758.47,1772.69,1784.45,
     &      1796.00, 1810.24, 1821.99,1835.26,1847.97,1862.41,1876.85,
     &       1891.14,1903.65,1919.06,1934.48, 1949.03,1963.46,1980.70,
     &       1995.22,2011.50, 2026.98, 2044.31,2060.60,2078.90,2097.18,
     &         2118.35,2139.54, 2150.11/

!    CaTiO3
      DATA  TconCaTiO3/1600.35,1609.68,1616.74,1626.47,1633.19,
     &     1643.94, 1652.50,1662.08,1672.50,1681.30,1692.50,1703.94,
     &     1712.95,1723.94,1735.02,1744.61,1755.37,1766.81,1778.25,
     &     1788.78,1798.49,1810.72,1821.12,1832.96,1845.32,1855.43,
     &     1867.42,1879.89,1892.37,1904.05,1917.31,1929.79,1941.23,
     &     1952.67,1966.98,1979.67,1992.73,2007.04,2021.35,2035.31,
     &     2047.77,2063.12,2078.59,2096.68,2112.02,2130.14,2144.45,
     &     2161.64,2182.03,2204.63, 2213.67/

!    Al2O3
       DATA   TCONAl2O3 /1685.09, 1693.08, 1700.92,1708.84, 1716.78,
     &              1724.79,1732.91, 1741.42,1750.37,1759.75, 
     &              1769.31,1779.06,1789.37,1799.94, 1810.65,1820.94,
     &              1830.99,1841.08,1851.02, 1861.02,1871.26,1881.74,
     &              1892.36,1903.03,1913.69,1924.39,1935.05,1945.95,
     &              1957.45,1969.45,1980.72,1989.12,1995.54, 2002.05,
     &              2010.76,2021.69,2033.01,2044.36, 2055.67,2066.99,
     &              2078.33,2089.65,2100.99,2112.62,2124.88,2137.43,
     &              2150.32,2163.28, 2176.89, 2191.32,2198.76/

!    Scattering Params
!         /MnS,Al2O3,Fe,Mg2SiO4,MgSiO3,Na2S,KCl,Cr/
!      DATA  swPI0s  /0.9999,0.86 ,0.69 ,0.9999,0.9999/!,0.954,1.0  ,0.713/
!      DATA  lwPI0s  /0.9999,0.32 ,0.27 ,0.61, 0.61/!, 0.4352,.99997,0.412/
!      DATA  swgs    /0.28 ,0.65,  0.46,  0.6,  0.61/! ,0.584,  0.68 ,.411/
!      DATA  lwgs    /0.06  ,0.03 ,-0.18, 0.05 , 0.03/!, 0.03,0.027,-0.3/
!      DATA  lwxfact /0.007, 0.006, 0.054, 0.0026, 0.003/!,0.0029,0.0012 ,0.031/

      DATA rps/ 0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,0.1000e-6,
     &  0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6, 
     &  0.1000e-6,  0.1000e-6,
     &   0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,  0.1000e-6,
     &   0.1023e-6,  0.1060e-6,
     &   0.1108e-6,  0.1170e-6,  0.1250e-6,  0.1360e-6,  0.1510e-6,
     &   0.1700e-6,  0.1950e-6,
     &   0.2285e-6,  0.2723e-6,  0.3300e-6,  0.4060e-6,  0.5060e-6, 
     &   0.6387e-6,  0.8130e-6,
     &   1.0430e-6,  1.3458e-6,  1.7450e-6,  2.2710e-6,  2.9660e-6, 
     &   3.8800e-6,  5.0870e-6,
     &   6.6767e-6,  8.7720e-6, 11.536e-6, 15.1780e-6, 19.9800e-6,
     &  26.3100e-6, 34.6500e-6, 45.6500e-6, 60.1540e-6, 79.2700e-6/
!     KCl                 
!    0.6500microns
      DATA      KClqevis/  0.4253,  0.4253,  0.4253,  0.4253,  0.4253,
     &  0.4253,  0.4253,  0.4253,  0.4253,  0.4253,  0.4253,  0.4253,
     &  0.4253,  0.4253,  0.4253,  0.4253,  0.4253,  0.4564,  0.5088,
     &  0.5804,  0.6775,  0.8088,  1.0009,  1.2849,  1.6500,  2.1239,
     &  2.6864,  3.2344,  3.5715,  3.4869,  3.0368,  2.6296,  2.4245,
     &  2.3953,  2.3432,  2.2801,  2.2341,  2.1940,  2.1614,  2.1351,
     &  2.1119,  2.0936,  2.0780,  2.0650,  2.0540,  2.0449,  2.0375,
     &  2.0313,  2.0260,  2.0217/
  
      DATA      KClg0vis/  0.4346,  0.4346,  0.4346,  0.4346,  0.4346,
     &  0.4346,  0.4346,  0.4346,  0.4346,  0.4346,  0.4346,  0.4346,
     &  0.4346,  0.4346,  0.4346,  0.4346,  0.4346,  0.4487,  0.4695,
     &  0.4930,  0.5186,  0.5465,  0.5799,  0.6186,  0.6530,  0.6852,
     &  0.7132,  0.7314,  0.7339,  0.7127,  0.6716,  0.6485,  0.6691,
     &  0.7147,  0.7442,  0.7611,  0.7725,  0.7847,  0.7938,  0.8017,
     &  0.8085,  0.8136,  0.8178,  0.8212,  0.8240,  0.8262,  0.8279,
     &  0.8292,  0.8303,  0.8311/
  
      DATA      KClpi0vis/  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000/
  
!  5.0000microns
      DATA      KClqevir/  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,
     &  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,
     &  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,  0.0002,
     &  0.0003,  0.0003,  0.0004,  0.0006,  0.0009,  0.0014,  0.0024,
     &  0.0046,  0.0093,  0.0199,  0.0446,  0.1006,  0.2199,  0.4669,
     &  0.9235,  1.6361,  2.5329,  3.3297,  3.5600,  3.1068,  2.6189,
     &  2.4053,  2.3739,  2.3181,  2.2593,  2.2111,  2.1779,  2.1469,
     &  2.1218,  2.1007,  2.0840/
  
      DATA      KClg0vir/  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,
     &  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,
     &  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0078,  0.0084,
     &  0.0091,  0.0102,  0.0116,  0.0138,  0.0169,  0.0214,  0.0282,
     &  0.0386,  0.0546,  0.0799,  0.1208,  0.1891,  0.3066,  0.4651,
     &  0.5796,  0.6638,  0.7184,  0.7447,  0.7354,  0.6907,  0.6597,
     &  0.6832,  0.7295,  0.7554,  0.7713,  0.7838,  0.7948,  0.8037,
     &  0.8108,  0.8168,  0.8214/
  
      DATA      KClpi0vir/  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000/
  
! ZnS                 
!  0.6500microns
      DATA      ZnSqevis/  3.0477,  3.0477,  3.0477,  3.0477,  3.0477,
     &  3.0477,  3.0477,  3.0477,  3.0477,  3.0477,  3.0477,  3.0477,
     &  3.0477,  3.0477,  3.0477,  3.0477,  3.0477,  3.1651,  3.3361,
     &  3.5286,  3.7243,  3.9166,  4.0023,  3.9750,  3.7359,  3.3833,
     &  3.0544,  2.7931,  2.6901,  2.6319,  2.5623,  2.4788,  2.4097,
     &  2.3517,  2.2980,  2.2558,  2.2142,  2.1849,  2.1514,  2.1287,
     &  2.1076,  2.0905,  2.0760,  2.0632,  2.0535,  2.0442,  2.0371,
     &  2.0309,  2.0254,  2.0335/
  
      DATA      ZnSg0vis/  0.3883,  0.3883,  0.3883,  0.3883,  0.3883,
     &  0.3883,  0.3883,  0.3883,  0.3883,  0.3883,  0.3883,  0.3883,
     &  0.3883,  0.3883,  0.3883,  0.3883,  0.3883,  0.3872,  0.3843,
     &  0.3793,  0.3716,  0.3606,  0.3481,  0.3253,  0.3026,  0.2885,
     &  0.3087,  0.3559,  0.4155,  0.4631,  0.4902,  0.5142,  0.5368,
     &  0.5582,  0.5770,  0.5915,  0.6055,  0.6152,  0.6252,  0.6321,
     &  0.6380,  0.6427,  0.6466,  0.6494,  0.6516,  0.6536,  0.6552,
     &  0.6566,  0.6577,  0.6610/
  
      DATA      ZnSpi0vis/  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,
     &  0.9998,  0.9998,  0.9998,  0.9997,  0.9997,  0.9996,  0.9995,
     &  0.9994,  0.9992,  0.9989,  0.9987,  0.9982,  0.9977,  0.9970,
     &  0.9962,  0.9950,  0.9935/
  
!  5.0000microns
      DATA      ZnSqevir/  0.0007,  0.0007,  0.0007,  0.0007,  0.0007,
     &  0.0007,  0.0007,  0.0007,  0.0007,  0.0007,  0.0007,  0.0007,
     &  0.0007,  0.0007,  0.0007,  0.0007,  0.0007,  0.0008,  0.0009,
     &  0.0011,  0.0014,  0.0018,  0.0025,  0.0039,  0.0063,  0.0111,
     &  0.0215,  0.0451,  0.1023,  0.2483,  0.6767,  1.7278,  3.0471,
     &  3.9353,  3.8076,  3.1736,  2.7664,  2.6618,  2.5857,  2.4926,
     &  2.3973,  2.3361,  2.2843,  2.2362,  2.1999,  2.1652,  2.1395,
     &  2.1174,  2.0981,  2.0809/
  
      DATA      ZnSg0vir/  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,
     &  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,
     &  0.0111,  0.0111,  0.0111,  0.0111,  0.0111,  0.0116,  0.0124,
     &  0.0136,  0.0151,  0.0173,  0.0205,  0.0252,  0.0320,  0.0422,
     &  0.0582,  0.0834,  0.1256,  0.2032,  0.3583,  0.4082,  0.4111,
     &  0.3874,  0.3390,  0.3187,  0.3780,  0.4604,  0.5004,  0.5275,
     &  0.5547,  0.5779,  0.5953,  0.6117,  0.6238,  0.6345,  0.6424,
     &  0.6490,  0.6541,  0.6584/
  
      DATA      ZnSpi0vir/  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,
     &  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,
     &  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9993,  0.9993,
     &  0.9994,  0.9995,  0.9996,  0.9997,  0.9998,  0.9998,  0.9999,
     &  0.9999,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  1.0000,  0.9999,  0.9999,  0.9999,
     &  0.9999,  0.9997,  0.9998,  0.9998,  0.9997,  0.9997,  0.9996,
     &  0.9995,  0.9993,  0.9991/
  
! Na2S                
!  0.6500microns
      DATA      Na2Sqevis/  1.2309,  1.2309,  1.2309,  1.2309,  1.2309,
     &  1.2309,  1.2309,  1.2309,  1.2309,  1.2309,  1.2309,  1.2309,
     &  1.2309,  1.2309,  1.2309,  1.2309,  1.2309,  1.3082,  1.4329,
     &  1.5967,  1.8159,  2.1062,  2.4734,  2.8968,  3.3387,  3.6757,
     &  3.7823,  3.5536,  3.1218,  2.7653,  2.5644,  2.5172,  2.4536,
     &  2.3819,  2.3172,  2.2668,  2.2242,  2.1881,  2.1576,  2.1320,
     &  2.1104,  2.0923,  2.0771,  2.0644,  2.0537,  2.0448,  2.0374,
     &  2.0311,  2.0259,  2.0216/
  
      DATA      Na2Sg0vis/  0.4668,  0.4668,  0.4668,  0.4668,  0.4668,
     &  0.4668,  0.4668,  0.4668,  0.4668,  0.4668,  0.4668,  0.4668,
     &  0.4668,  0.4668,  0.4668,  0.4668,  0.4668,  0.4731,  0.4825,
     &  0.4940,  0.5089,  0.5273,  0.5458,  0.5598,  0.5739,  0.5791,
     &  0.5728,  0.5497,  0.5251,  0.5408,  0.5976,  0.6683,  0.7129,
     &  0.7457,  0.7779,  0.8097,  0.8385,  0.8633,  0.8835,  0.8985,
     &  0.9083,  0.9139,  0.9165,  0.9176,  0.9179,  0.9179,  0.9178,
     &  0.9177,  0.9176,  0.9175/
  
      DATA      Na2Spi0vis/  0.9493,  0.9493,  0.9493,  0.9493,  0.9493,
     &  0.9493,  0.9493,  0.9493,  0.9493,  0.9493,  0.9493,  0.9493,
     &  0.9493,  0.9493,  0.9493,  0.9493,  0.9493,  0.9502,  0.9516,
     &  0.9530,  0.9542,  0.9554,  0.9566,  0.9570,  0.9559,  0.9522,
     &  0.9440,  0.9282,  0.9020,  0.8707,  0.8421,  0.8220,  0.7983,
     &  0.7691,  0.7357,  0.7010,  0.6665,  0.6346,  0.6077,  0.5876,
     &  0.5747,  0.5681,  0.5657,  0.5655,  0.5661,  0.5667,  0.5671,
     &  0.5675,  0.5677,  0.5678/
  
!  5.0000microns
      DATA      Na2Sqevir/  0.0033,  0.0033,  0.0033,  0.0033,  0.0033,
     &  0.0033,  0.0033,  0.0033,  0.0033,  0.0033,  0.0033,  0.0033,
     &  0.0033,  0.0033,  0.0033,  0.0033,  0.0033,  0.0034,  0.0035,
     &  0.0038,  0.0041,  0.0045,  0.0052,  0.0064,  0.0082,  0.0113,
     &  0.0174,  0.0297,  0.0568,  0.1194,  0.2621,  0.5882,  1.2487,
     &  2.2143,  3.2145,  3.7447,  3.4901,  2.9171,  2.5860,  2.5060,
     &  2.4381,  2.3615,  2.2976,  2.2483,  2.2060,  2.1716,  2.1433,
     &  2.1196,  2.0997,  2.0832/
  
      DATA      Na2Sg0vir/  0.0085,  0.0085,  0.0085,  0.0085,  0.0085,
     &  0.0085,  0.0085,  0.0085,  0.0085,  0.0085,  0.0085,  0.0085,
     &  0.0085,  0.0085,  0.0085,  0.0085,  0.0085,  0.0089,  0.0096,
     &  0.0105,  0.0117,  0.0133,  0.0157,  0.0194,  0.0245,  0.0322,
     &  0.0441,  0.0625,  0.0919,  0.1405,  0.2261,  0.3744,  0.4836,
     &  0.5547,  0.5943,  0.6021,  0.5710,  0.5464,  0.5923,  0.6725,
     &  0.7234,  0.7575,  0.7903,  0.8218,  0.8497,  0.8735,  0.8926,
     &  0.9066,  0.9155,  0.9205/
  
      DATA      Na2Spi0vir/  0.1100,  0.1100,  0.1100,  0.1100,  0.1100,
     &  0.1100,  0.1100,  0.1100,  0.1100,  0.1100,  0.1100,  0.1100,
     &  0.1100,  0.1100,  0.1100,  0.1100,  0.1100,  0.1168,  0.1281,
     &  0.1435,  0.1645,  0.1932,  0.2350,  0.2947,  0.3716,  0.4684,
     &  0.5815,  0.6949,  0.7937,  0.8670,  0.9132,  0.9385,  0.9531,
     &  0.9592,  0.9597,  0.9525,  0.9321,  0.8962,  0.8593,  0.8340,
     &  0.8078,  0.7758,  0.7398,  0.7026,  0.6658,  0.6323,  0.6045,
     &  0.5842,  0.5715,  0.5651/
  
! MnS                 
!  0.6500microns
      DATA      MnSqevis/  3.8495,  3.8495,  3.8495,  3.8495,  3.8495,
     &  3.8495,  3.8495,  3.8495,  3.8495,  3.8495,  3.8495,  3.8495,
     &  3.8495,  3.8495,  3.8495,  3.8495,  3.8495,  3.9001,  3.9573,
     &  3.9597,  3.9157,  3.8439,  3.6497,  3.4109,  3.1639,  2.9424,
     &  2.7762,  2.7539,  2.6839,  2.6088,  2.5255,  2.4555,  2.3888,
     &  2.3339,  2.2846,  2.2424,  2.2102,  2.1749,  2.1510,  2.1258,
     &  2.1060,  2.0876,  2.0745,  2.0561,  2.0526,  2.0440,  2.0368,
     &  2.0308,  2.0257,  2.0215/
  

      DATA      MnSg0vis/  0.2496,  0.2496,  0.2496,  0.2496,  0.2496,
     &  0.2496,  0.2496,  0.2496,  0.2496,  0.2496,  0.2496,  0.2496,
     &  0.2496,  0.2496,  0.2496,  0.2496,  0.2496,  0.2440,  0.2370,
     &  0.2294,  0.2212,  0.2105,  0.2013,  0.2097,  0.2362,  0.2751,
     &  0.3216,  0.3735,  0.3984,  0.4236,  0.4508,  0.4776,  0.5018,
     &  0.5211,  0.5402,  0.5563,  0.5692,  0.5844,  0.5965,  0.6088,
     &  0.6211,  0.6339,  0.6480,  0.6621,  0.6805,  0.6994,  0.7197,
     &  0.7405,  0.7606,  0.7787/
  
      DATA MnSpi0vis/  0.9982,  0.9982,  0.9982,  0.9982,  0.9982,
     &  0.9982,  0.9982,  0.9982,  0.9982,  0.9982,  0.9982,  0.9982,
     &  0.9982,  0.9982,  0.9982,  0.9982,  0.9982,  0.9981,  0.9979,
     &  0.9978,  0.9976,  0.9973,  0.9968,  0.9960,  0.9951,  0.9939,
     &  0.9934,  0.9919,  0.9916,  0.9902,  0.9894,  0.9876,  0.9861,
     &  0.9834,  0.9804,  0.9762,  0.9705,  0.9641,  0.9552,  0.9445,
     &  0.9312,  0.9146,  0.8943,  0.8700,  0.8429,  0.8122,  0.7794,
     &  0.7461,  0.7142,  0.6860/
  
!  5.0000microns
      DATA      MnSqevir/  0.0010,  0.0010,  0.0010,  0.0010,  0.0010,
     &  0.0010,  0.0010,  0.0010,  0.0010,  0.0010,  0.0010,  0.0010,
     &  0.0010,  0.0010,  0.0010,  0.0010,  0.0010,  0.0011,  0.0012,
     &  0.0015,  0.0018,  0.0024,  0.0034,  0.0052,  0.0084,  0.0149,
     &  0.0291,  0.0618,  0.1440,  0.3803,  1.2915,  2.6366,  3.8117,
     &  3.9100,  3.2934,  2.8637,  2.7291,  2.6461,  2.5494,  2.4574,
     &  2.3775,  2.3176,  2.2700,  2.2262,  2.1919,  2.1622,  2.1374,
     &  2.1146,  2.0960,  2.0807/
  
      DATA      MnSg0vir/  0.0133,  0.0133,  0.0133,  0.0133,  0.0133,
     &  0.0133,  0.0133,  0.0133,  0.0133,  0.0133,  0.0133,  0.0133,
     &  0.0133,  0.0133,  0.0133,  0.0133,  0.0133,  0.0139,  0.0149,
     &  0.0163,  0.0182,  0.0208,  0.0247,  0.0305,  0.0388,  0.0515,
     &  0.0716,  0.1045,  0.1633,  0.2894,  0.3707,  0.3371,  0.3020,
     &  0.2518,  0.2407,  0.3086,  0.3904,  0.4306,  0.4611,  0.4897,
     &  0.5171,  0.5384,  0.5556,  0.5701,  0.5818,  0.5912,  0.6000,
     &  0.6054,  0.6106,  0.6146/
  
      DATA     MnSpi0vir/  0.9986,  0.9986,  0.9986,  0.9986,  0.9986,
     &  0.9986,  0.9986,  0.9986,  0.9986,  0.9986,  0.9986,  0.9986,
     &  0.9986,  0.9986,  0.9986,  0.9986,  0.9986,  0.9987,  0.9989,
     &  0.9990,  0.9991,  0.9993,  0.9994,  0.9996,  0.9997,  0.9998,
     &  0.9999,  0.9999,  0.9999,  1.0000,  1.0000,  1.0000,  1.0000,
     &  0.9999,  0.9999,  0.9999,  0.9998,  0.9997,  0.9997,  0.9997,
     &  0.9997,  0.9996,  0.9994,  0.9994,  0.9992,  0.9990,  0.9987,
     &  0.9984,  0.9980,  0.9974/
  
! Cr2O3               
!  0.6500microns
      DATA    Cr2O3qevis/  2.8387,  2.8387,  2.8387,  2.8387,  2.8387,
     &  2.8387,  2.8387,  2.8387,  2.8387,  2.8387,  2.8387,  2.8387,
     &  2.8387,  2.8387,  2.8387,  2.8387,  2.8387,  2.8546,  2.8749,
     &  2.8932,  2.9062,  2.9106,  2.9038,  2.8850,  2.8559,  2.8171,
     &  2.7698,  2.7163,  2.6581,  2.5974,  2.5379,  2.4807,  2.4278,
     &  2.3794,  2.3355,  2.2959,  2.2603,  2.2282,  2.1994,  2.1735,
     &  2.1501,  2.1292,  2.1104,  2.0938,  2.0791,  2.0663,  2.0551,
     &  2.0456,  2.0375,  2.0308/
  
      DATA    Cr2O3g0vis/  0.1013,  0.1013,  0.1013,  0.1013,  0.1013,
     &  0.1013,  0.1013,  0.1013,  0.1013,  0.1013,  0.1013,  0.1013,
     &  0.1013,  0.1013,  0.1013,  0.1013,  0.1013,  0.1118,  0.1287,
     &  0.1504,  0.1780,  0.2124,  0.2570,  0.3112,  0.3671,  0.4223,
     &  0.4727,  0.5146,  0.5482,  0.5741,  0.5934,  0.6071,  0.6163,
     &  0.6222,  0.6256,  0.6273,  0.6278,  0.6274,  0.6264,  0.6251,
     &  0.6237,  0.6221,  0.6206,  0.6191,  0.6177,  0.6165,  0.6154,
     &  0.6144,  0.6135,  0.6128/
  
      DATA    Cr2O3pi0vis/  0.6771,  0.6771,  0.6771,  0.6771,  0.6771,
     &  0.6771,  0.6771,  0.6771,  0.6771,  0.6771,  0.6771,  0.6771,
     &  0.6771,  0.6771,  0.6771,  0.6771,  0.6771,  0.6801,  0.6845,
     &  0.6896,  0.6951,  0.7010,  0.7074,  0.7139,  0.7204,  0.7269,
     &  0.7336,  0.7402,  0.7467,  0.7528,  0.7584,  0.7636,  0.7682,
     &  0.7725,  0.7764,  0.7799,  0.7831,  0.7862,  0.7890,  0.7917,
     &  0.7943,  0.7967,  0.7990,  0.8011,  0.8031,  0.8048,  0.8064,
     &  0.8078,  0.8090,  0.8099/
  
!  5.0000microns
      DATA   Cr2O3qevir/  0.0290,  0.0290,  0.0290,  0.0290,  0.0290,
     &  0.0290,  0.0290,  0.0290,  0.0290,  0.0290,  0.0290,  0.0290,
     &  0.0290,  0.0290,  0.0290,  0.0290,  0.0290,  0.0301,  0.0318,
     &  0.0341,  0.0371,  0.0411,  0.0470,  0.0558,  0.0690,  0.0916,
     &  0.1352,  0.2254,  0.4193,  0.7962,  1.3508,  1.9039,  2.2520,
     &  2.3729,  2.3764,  2.3484,  2.3115,  2.2719,  2.2340,  2.2007,
     &  2.1723,  2.1486,  2.1289,  2.1127,  2.0992,  2.0879,  2.0785,
     &  2.0705,  2.0637,  2.0578/
  
!      DATA     Cr2O3g0vir/ -0.1671, -0.1671, -0.1671, -0.1671, -0.1671,
!     & -0.1671, -0.1671, -0.1671, -0.1671, -0.1671, -0.1671, -0.1671,
!     & -0.1671, -0.1671, -0.1671, -0.1671, -0.1671, -0.1705, -0.1757,
!     & -0.1821, -0.1897, -0.1985, -0.2088, -0.2201, -0.2304, -0.2385,
!    & -0.2424, -0.2389, -0.2253, -0.1997, -0.1612, -0.1005, -0.0003,
!     &  0.1311,  0.2619,  0.3592,  0.4218,  0.4612,  0.4862,  0.5017,
!     &  0.5112,  0.5169,  0.5202,  0.5219,  0.5227,  0.5229,  0.5227,
!     &  0.5224,  0.5218,  0.5212/

      DATA     Cr2O3g0vir/  0.1671, 0.1671, 0.1671,  0.1671,  0.1671,
     &  0.1671,  0.1671,  0.1671,  0.1671,  0.1671,  0.1671,  0.1671,
     &  0.1671,  0.1671,  0.1671,  0.1671,  0.1671,  0.1705,  0.1757,
     &  0.1821,  0.1897,  0.1985,  0.2088,  0.2201,  0.2304,  0.2385,
     &  0.2424,  0.2389,  0.2253,  0.1997,  0.1612,  0.1005,  0.0003,
     &  0.1311,  0.2619,  0.3592,  0.4218,  0.4612,  0.4862,  0.5017,
     &  0.5112,  0.5169,  0.5202,  0.5219,  0.5227,  0.5229,  0.5227,
     &  0.5224,  0.5218,  0.5212/



  
      DATA    Cr2O3pi0vir/  0.0816,  0.0816,  0.0816,  0.0816,  0.0816,
     &  0.0816,  0.0816,  0.0816,  0.0816,  0.0816,  0.0816,  0.0816,
     &  0.0816,  0.0816,  0.0816,  0.0816,  0.0816,  0.0864,  0.0947,
     &  0.1062,  0.1223,  0.1453,  0.1809,  0.2360,  0.3139,  0.4219,
     &  0.5582,  0.6973,  0.8100,  0.8812,  0.9191,  0.9384,  0.9483,
     &  0.9536,  0.9566,  0.9587,  0.9604,  0.9617,  0.9627,  0.9636,
     &  0.9642,  0.9647,  0.9652,  0.9655,  0.9657,  0.9659,  0.9661,
     &  0.9662,  0.9663,  0.9664/
  
! SiO2                
!  0.6500microns
      DATA    SiO2qevis/  0.5325,  0.5325,  0.5325,  0.5325,  0.5325,
     &  0.5325,  0.5325,  0.5325,  0.5325,  0.5325,  0.5325,  0.5325,
     &  0.5325,  0.5325,  0.5325,  0.5325,  0.5325,  0.5718,  0.6373,
     &  0.7257,  0.8439,  1.0025,  1.2351,  1.5708,  1.9815,  2.4957,
     &  3.0538,  3.5075,  3.6425,  3.3451,  2.8666,  2.5495,  2.4314,
     &  2.3899,  2.3335,  2.2793,  2.2303,  2.1936,  2.1613,  2.1347,
     &  2.1115,  2.0931,  2.0780,  2.0649,  2.0539,  2.0450,  2.0376,
     &  2.0312,  2.0256,  2.0217/
  
      DATA     SiO2g0vis/  0.4451,  0.4451,  0.4451,  0.4451,  0.4451,
     &  0.4451,  0.4451,  0.4451,  0.4451,  0.4451,  0.4451,  0.4451,
     &  0.4451,  0.4451,  0.4451,  0.4451,  0.4451,  0.4579,  0.4765,
     &  0.4971,  0.5197,  0.5449,  0.5763,  0.6113,  0.6409,  0.6695,
     &  0.6916,  0.7022,  0.6931,  0.6594,  0.6207,  0.6221,  0.6630,
     &  0.7060,  0.7289,  0.7443,  0.7571,  0.7695,  0.7791,  0.7869,
     &  0.7936,  0.7989,  0.8030,  0.8064,  0.8095,  0.8119,  0.8140,
     &  0.8157,  0.8174,  0.8189/
  
      DATA   SiO2pi0vis/  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,
     &  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,
     &  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,  0.9999,
     &  0.9999,  0.9999,  1.0000,  1.0000,  1.0000,  1.0000,  1.0000,
     &  1.0000,  1.0000,  1.0000,  0.9999,  0.9999,  0.9999,  0.9998,
     &  0.9998,  0.9996,  0.9996,  0.9995,  0.9993,  0.9992,  0.9989,
     &  0.9987,  0.9983,  0.9978,  0.9972,  0.9963,  0.9953,  0.9938,
     &  0.9920,  0.9896,  0.9863/
  
!  5.0000microns
      DATA    SiO2qevir/  0.0005,  0.0005,  0.0005,  0.0005,  0.0005,
     &  0.0005,  0.0005,  0.0005,  0.0005,  0.0005,  0.0005,  0.0005,
     &  0.0005,  0.0005,  0.0005,  0.0005,  0.0005,  0.0006,  0.0006,
     &  0.0006,  0.0007,  0.0008,  0.0010,  0.0013,  0.0018,  0.0027,
     &  0.0046,  0.0085,  0.0170,  0.0364,  0.0800,  0.1718,  0.3566,
     &  0.7086,  1.2844,  2.0784,  2.9373,  3.4719,  3.3127,  2.7688,
     &  2.4422,  2.3641,  2.3208,  2.2656,  2.2140,  2.1777,  2.1467,
     &  2.1223,  2.1016,  2.0844/
  
      DATA  SiO2g0vir/  0.0073,  0.0073,  0.0073,  0.0073,  0.0073,
     &  0.0073,  0.0073,  0.0073,  0.0073,  0.0073,  0.0073,  0.0073,
     &  0.0073,  0.0073,  0.0073,  0.0073,  0.0073,  0.0076,  0.0082,
     &  0.0089,  0.0099,  0.0113,  0.0134,  0.0165,  0.0209,  0.0274,
     &  0.0376,  0.0532,  0.0778,  0.1176,  0.1835,  0.2956,  0.4546,
     &  0.5818,  0.6755,  0.7381,  0.7754,  0.7836,  0.7576,  0.7136,
     &  0.7085,  0.7478,  0.7840,  0.8056,  0.8204,  0.8346,  0.8478,
     &  0.8604,  0.8725,  0.8846/
  
      DATA  SiO2pi0vir/  0.2519,  0.2519,  0.2519,  0.2519,  0.2519,
     &  0.2519,  0.2519,  0.2519,  0.2519,  0.2519,  0.2519,  0.2519,
     &  0.2519,  0.2519,  0.2519,  0.2519,  0.2519,  0.2648,  0.2859,
     &  0.3135,  0.3492,  0.3949,  0.4557,  0.5326,  0.6173,  0.7063,
     &  0.7915,  0.8618,  0.9136,  0.9479,  0.9684,  0.9799,  0.9862,
     &  0.9900,  0.9922,  0.9933,  0.9935,  0.9926,  0.9896,  0.9834,
     &  0.9753,  0.9671,  0.9582,  0.9476,  0.9344,  0.9179,  0.8974,
     &  0.8725,  0.8425,  0.8077/
  
! Mg2SiO4             
!  0.6500microns
      DATA  Mg2SiO4qevis/  0.7018,  0.7018,  0.7018,  0.7018,  0.7018,
     &  0.7018,  0.7018,  0.7018,  0.7018,  0.7018,  0.7018,  0.7018,
     &  0.7018,  0.7018,  0.7018,  0.7018,  0.7018,  0.7530,  0.8371,
     &  0.9486,  1.0960,  1.2939,  1.5842,  1.9760,  2.4337,  2.9579,
     &  3.4491,  3.7091,  3.5731,  3.1163,  2.7132,  2.4928,  2.4552,
     &  2.3989,  2.3323,  2.2710,  2.2273,  2.1905,  2.1604,  2.1334,
     &  2.1113,  2.0928,  2.0779,  2.0640,  2.0539,  2.0449,  2.0374,
     &  2.0312,  2.0260,  2.0216/
  
      DATA  Mg2SiO4g0vis/  0.4563,  0.4563,  0.4563,  0.4563,  0.4563,
     &  0.4563,  0.4563,  0.4563,  0.4563,  0.4563,  0.4563,  0.4563,
     &  0.4563,  0.4563,  0.4563,  0.4563,  0.4563,  0.4670,  0.4822,
     &  0.4991,  0.5182,  0.5407,  0.5693,  0.5983,  0.6217,  0.6447,
     &  0.6580,  0.6561,  0.6307,  0.5896,  0.5745,  0.6055,  0.6597,
     &  0.6923,  0.7112,  0.7267,  0.7411,  0.7532,  0.7633,  0.7722,
     &  0.7799,  0.7867,  0.7926,  0.7985,  0.8043,  0.8104,  0.8172,
     &  0.8248,  0.8336,  0.8436/
  
      DATA  Mg2SiO4pi0vis/  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,
     &  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,
     &  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9993,
     &  0.9993,  0.9993,  0.9994,  0.9994,  0.9994,  0.9995,  0.9995,
     &  0.9994,  0.9993,  0.9991,  0.9988,  0.9982,  0.9975,  0.9967,
     &  0.9959,  0.9948,  0.9939,  0.9922,  0.9904,  0.9878,  0.9846,
     &  0.9804,  0.9750,  0.9679,  0.9591,  0.9475,  0.9330,  0.9148,
     &  0.8924,  0.8653,  0.8332/
  
!  5.0000microns
      DATA  Mg2SiO4qevir/  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,
     &  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,
     &  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0030,
     &  0.0031,  0.0034,  0.0037,  0.0042,  0.0050,  0.0063,  0.0083,
     &  0.0122,  0.0197,  0.0358,  0.0714,  0.1504,  0.3172,  0.6650,
     &  1.2616,  2.1096,  3.0201,  3.5700,  3.4058,  2.8598,  2.5203,
     &  2.4293,  2.3751,  2.3109,  2.2531,  2.2104,  2.1742,  2.1452,
     &  2.1207,  2.1006,  2.0837/
  
      DATA  Mg2SiO4g0vir/  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,
     &  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,
     &  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,  0.0081,  0.0087,
     &  0.0095,  0.0106,  0.0121,  0.0143,  0.0176,  0.0222,  0.0292,
     &  0.0400,  0.0566,  0.0829,  0.1256,  0.1978,  0.3235,  0.4760,
     &  0.5777,  0.6511,  0.6966,  0.7099,  0.6855,  0.6497,  0.6671,
     &  0.7294,  0.7781,  0.8088,  0.8348,  0.8601,  0.8831,  0.9028,
     &  0.9190,  0.9311,  0.9391/
  
      DATA  Mg2SiO4pi0vir/  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,
     &  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,
     &  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,  0.0839,  0.0924,
     &  0.1040,  0.1200,  0.1423,  0.1755,  0.2246,  0.2907,  0.3793,
     &  0.4910,  0.6130,  0.7285,  0.8213,  0.8844,  0.9217,  0.9436,
     &  0.9561,  0.9624,  0.9635,  0.9583,  0.9421,  0.9110,  0.8745,
     &  0.8456,  0.8176,  0.7848,  0.7472,  0.7077,  0.6681,  0.6315,
     &  0.6004,  0.5771,  0.5619/
  
! VO                  
!  0.6500microns
      DATA  VOqevis/  2.2216,  2.2216,  2.2216,  2.2216,  2.2216,
     &  2.2216,  2.2216,  2.2216,  2.2216,  2.2216,  2.2216,  2.2216,
     &  2.2216,  2.2216,  2.2216,  2.2216,  2.2216,  2.2601,  2.3179,
     &  2.3859,  2.4627,  2.5453,  2.6334,  2.7166,  2.7773,  2.8083,
     &  2.8029,  2.7632,  2.7004,  2.6279,  2.5557,  2.4871,  2.4240,
     &  2.3663,  2.3145,  2.2686,  2.2283,  2.1932,  2.1629,  2.1370,
     &  2.1149,  2.0962,  2.0803,  2.0670,  2.0559,  2.0465,  2.0387,
     &  2.0322,  2.0267,  2.0222/
  
      DATA  VOg0vis/  0.3907,  0.3907,  0.3907,  0.3907,  0.3907,
     &  0.3907,  0.3907,  0.3907,  0.3907,  0.3907,  0.3907,  0.3907,
     &  0.3907,  0.3907,  0.3907,  0.3907,  0.3907,  0.4017,  0.4189,
     &  0.4401,  0.4659,  0.4965,  0.5342,  0.5782,  0.6234,  0.6688,
     &  0.7123,  0.7506,  0.7828,  0.8085,  0.8282,  0.8427,  0.8531,
     &  0.8605,  0.8657,  0.8694,  0.8718,  0.8735,  0.8745,  0.8751,
     &  0.8754,  0.8755,  0.8754,  0.8753,  0.8751,  0.8749,  0.8747,
     &  0.8745,  0.8742,  0.8740/
  
      DATA  VOpi0vis/  0.3584,  0.3584,  0.3584,  0.3584,  0.3584,
     &  0.3584,  0.3584,  0.3584,  0.3584,  0.3584,  0.3584,  0.3584,
     &  0.3584,  0.3584,  0.3584,  0.3584,  0.3584,  0.3632,  0.3705,
     &  0.3791,  0.3889,  0.3998,  0.4121,  0.4249,  0.4369,  0.4478,
     &  0.4580,  0.4677,  0.4782,  0.4902,  0.5036,  0.5174,  0.5305,
     &  0.5423,  0.5526,  0.5615,  0.5690,  0.5752,  0.5802,  0.5843,
     &  0.5875,  0.5899,  0.5918,  0.5933,  0.5943,  0.5951,  0.5956,
     &  0.5959,  0.5962,  0.5963/
  
!  5.0000microns
      DATA  VOqevir/  0.0664,  0.0664,  0.0664,  0.0664,  0.0664,
     &  0.0664,  0.0664,  0.0664,  0.0664,  0.0664,  0.0664,  0.0664,
     &  0.0664,  0.0664,  0.0664,  0.0664,  0.0664,  0.0695,  0.0748,
     &  0.0820,  0.0918,  0.1054,  0.1257,  0.1562,  0.1988,  0.2617,
     &  0.3597,  0.5191,  0.7978,  1.2577,  1.8479,  2.3664,  2.6451,
     &  2.7034,  2.6667,  2.6073,  2.5427,  2.4783,  2.4187,  2.3657,
     &  2.3195,  2.2796,  2.2451,  2.2152,  2.1891,  2.1663,  2.1462,
     &  2.1283,  2.1124,  2.0982/
  
!      DATA  VOg0vir/ -0.0207, -0.0207, -0.0207, -0.0207, -0.0207,
!     & -0.0207, -0.0207, -0.0207, -0.0207, -0.0207, -0.0207, -0.0207,
!     & -0.0207, -0.0207, -0.0207, -0.0207, -0.0207, -0.0222, -0.0248,
!     & -0.0284, -0.0334, -0.0403, -0.0505, -0.0651, -0.0833, -0.1043,
!     & -0.1244, -0.1365, -0.1345, -0.1156, -0.0796, -0.0180,  0.0841,
!     &  0.2150,  0.3421,  0.4357,  0.4965,  0.5354,  0.5604,  0.5761,
!     &  0.5857,  0.5915,  0.5946,  0.5961,  0.5965,  0.5962,  0.5954,
!     &  0.5944,  0.5933,  0.5921/

      DATA  VOg0vir/ 0.0207, 0.0207, 0.0207, 0.0207, 0.0207,
     & 0.0207, 0.0207, 0.0207, 0.0207, 0.0207, 0.0207, 0.0207,
     & 0.0207, 0.0207, 0.0207, 0.0207, 0.0207, 0.0222, 0.0248,
     & 0.0284, 0.0334, 0.0403, 0.0505, 0.0651, 0.0833, 0.1043,
     & 0.1244, 0.1365, 0.1345, 0.1156, 0.0796, 0.0180,  0.0841,
     &  0.2150,  0.3421,  0.4357,  0.4965,  0.5354,  0.5604,  0.5761,
     &  0.5857,  0.5915,  0.5946,  0.5961,  0.5965,  0.5962,  0.5954,
     &  0.5944,  0.5933,  0.5921/

  
      DATA  VOpi0vir/  0.0346,  0.0346,  0.0346,  0.0346,  0.0346,
     &  0.0346,  0.0346,  0.0346,  0.0346,  0.0346,  0.0346,  0.0346,
     &  0.0346,  0.0346,  0.0346,  0.0346,  0.0346,  0.0363,  0.0390,
     &  0.0427,  0.0478,  0.0548,  0.0654,  0.0818,  0.1063,  0.1452,
     &  0.2087,  0.3041,  0.4272,  0.5493,  0.6417,  0.7019,  0.7381,
     &  0.7595,  0.7728,  0.7828,  0.7912,  0.7982,  0.8039,  0.8088,
     &  0.8128,  0.8162,  0.8192,  0.8217,  0.8240,  0.8260,  0.8279,
     &  0.8296,  0.8312,  0.8328/
  
! Ni                  
!  0.6500microns
      DATA  Niqevis/  3.0151,  3.0151,  3.0151,  3.0151,  3.0151,
     &  3.0151,  3.0151,  3.0151,  3.0151,  3.0151,  3.0151,  3.0151,
     &  3.0151,  3.0151,  3.0151,  3.0151,  3.0151,  3.0305,  3.0497,
     &  3.0660,  3.0758,  3.0758,  3.0640,  3.0403,  3.0063,  2.9628,
     &  2.9102,  2.8508,  2.7860,  2.7183,  2.6517,  2.5871,  2.5268,
     &  2.4709,  2.4195,  2.3723,  2.3291,  2.2893,  2.2527,  2.2191,
     &  2.1884,  2.1604,  2.1352,  2.1127,  2.0930,  2.0761,  2.0618,
     &  2.0499,  2.0402,  2.0323/
  
      DATA  Nig0vis/  0.0991,  0.0991,  0.0991,  0.0991,  0.0991,
     &  0.0991,  0.0991,  0.0991,  0.0991,  0.0991,  0.0991,  0.0991,
     &  0.0991,  0.0991,  0.0991,  0.0991,  0.0991,  0.1093,  0.1258,
     &  0.1470,  0.1741,  0.2080,  0.2521,  0.3060,  0.3615,  0.4160,
     &  0.4657,  0.5071,  0.5402,  0.5658,  0.5848,  0.5982,  0.6071,
     &  0.6125,  0.6153,  0.6163,  0.6160,  0.6147,  0.6128,  0.6105,
     &  0.6081,  0.6055,  0.6031,  0.6008,  0.5987,  0.5968,  0.5952,
     &  0.5938,  0.5926,  0.5916/
  
      DATA  Nipi0vis/  0.7281,  0.7281,  0.7281,  0.7281,  0.7281,
     &  0.7281,  0.7281,  0.7281,  0.7281,  0.7281,  0.7281,  0.7281,
     &  0.7281,  0.7281,  0.7281,  0.7281,  0.7281,  0.7307,  0.7346,
     &  0.7391,  0.7439,  0.7489,  0.7542,  0.7596,  0.7648,  0.7699,
     &  0.7752,  0.7803,  0.7853,  0.7900,  0.7942,  0.7982,  0.8018,
     &  0.8051,  0.8083,  0.8112,  0.8141,  0.8169,  0.8197,  0.8225,
     &  0.8254,  0.8282,  0.8309,  0.8335,  0.8360,  0.8382,  0.8401,
     &  0.8417,  0.8430,  0.8440/
  
!  5.0000microns
      DATA  Niqevir/  0.0406,  0.0406,  0.0406,  0.0406,  0.0406,
     &  0.0406,  0.0406,  0.0406,  0.0406,  0.0406,  0.0406,  0.0406,
     &  0.0406,  0.0406,  0.0406,  0.0406,  0.0406,  0.0423,  0.0451,
     &  0.0488,  0.0537,  0.0601,  0.0694,  0.0828,  0.1017,  0.1314,
     &  0.1843,  0.2868,  0.4985,  0.8987,  1.4721,  2.0276,  2.3641,
     &  2.4697,  2.4621,  2.4257,  2.3813,  2.3350,  2.2914,  2.2528,
     &  2.2197,  2.1918,  2.1683,  2.1485,  2.1319,  2.1177,  2.1055,
     &  2.0949,  2.0857,  2.0775/
  
!      DATA  Nig0vir/ -0.1178, -0.1178, -0.1178, -0.1178, -0.1178,
!     & -0.1178, -0.1178, -0.1178, -0.1178, -0.1178, -0.1178, -0.1178,
!     & -0.1178, -0.1178, -0.1178, -0.1178, -0.1178, -0.1212, -0.1264,
!     & -0.1330, -0.1411, -0.1508, -0.1627, -0.1765, -0.1899, -0.2019,
!     & -0.2099, -0.2103, -0.1999, -0.1767, -0.1400, -0.0805,  0.0190,
!     &  0.1497,  0.2795,  0.3759,  0.4379,  0.4772,  0.5021,  0.5177,
!     &  0.5272,  0.5328,  0.5360,  0.5376,  0.5382,  0.5382,  0.5377,
!     &  0.5371,  0.5363,  0.5355/

      DATA  Nig0vir/ 0.1178, 0.1178, 0.1178, 0.1178, 0.1178,
     & 0.1178, 0.1178, 0.1178, 0.1178, 0.1178, 0.1178, 0.1178,
     & 0.1178, 0.1178, 0.1178, 0.1178, 0.1178, 0.1212, 0.1264,
     & 0.1330, 0.1411, 0.1508, 0.1627, 0.1765, 0.1899, 0.2019,
     & 0.2099, 0.2103, 0.1999, 0.1767, 0.1400, 0.0805,  0.0190,
     &  0.1497,  0.2795,  0.3759,  0.4379,  0.4772,  0.5021,  0.5177,
     &  0.5272,  0.5328,  0.5360,  0.5376,  0.5382,  0.5382,  0.5377,
     &  0.5371,  0.5363,  0.5355/

  
      DATA  Nipi0vir/  0.0582,  0.0582,  0.0582,  0.0582,  0.0582,
     &  0.0582,  0.0582,  0.0582,  0.0582,  0.0582,  0.0582,  0.0582,
     &  0.0582,  0.0582,  0.0582,  0.0582,  0.0582,  0.0613,  0.0666,
     &  0.0740,  0.0843,  0.0991,  0.1221,  0.1587,  0.2129,  0.2947,
     &  0.4123,  0.5547,  0.6926,  0.7938,  0.8532,  0.8855,  0.9027,
     &  0.9120,  0.9173,  0.9211,  0.9242,  0.9266,  0.9286,  0.9302,
     &  0.9314,  0.9324,  0.9332,  0.9339,  0.9344,  0.9349,  0.9353,
     &  0.9356,  0.9359,  0.9362/
  
! Fe                  
!  0.6500microns
      DATA  Feqevis/  3.0753,  3.0753,  3.0753,  3.0753,  3.0753,
     &  3.0753,  3.0753,  3.0753,  3.0753,  3.0753,  3.0753,  3.0753,
     &  3.0753,  3.0753,  3.0753,  3.0753,  3.0753,  3.0885,  3.1046,
     &  3.1177,  3.1247,  3.1226,  3.1092,  3.0837,  3.0471,  3.0003,
     &  2.9432,  2.8787,  2.8084,  2.7351,  2.6627,  2.5925,  2.5267,
     &  2.4656,  2.4095,  2.3583,  2.3119,  2.2697,  2.2319,  2.1979,
     &  2.1677,  2.1410,  2.1177,  2.0976,  2.0804,  2.0660,  2.0539,
     &  2.0439,  2.0357,  2.0291/
  
      DATA  Feg0vis/  0.1432,  0.1432,  0.1432,  0.1432,  0.1432,
     &  0.1432,  0.1432,  0.1432,  0.1432,  0.1432,  0.1432,  0.1432,
     &  0.1432,  0.1432,  0.1432,  0.1432,  0.1432,  0.1536,  0.1702,
     &  0.1916,  0.2188,  0.2527,  0.2965,  0.3496,  0.4039,  0.4574,
     &  0.5063,  0.5470,  0.5798,  0.6051,  0.6240,  0.6374,  0.6463,
     &  0.6518,  0.6548,  0.6561,  0.6560,  0.6551,  0.6537,  0.6520,
     &  0.6501,  0.6483,  0.6465,  0.6448,  0.6433,  0.6419,  0.6407,
     &  0.6397,  0.6388,  0.6381/
  
      DATA  Fepi0vis/  0.6294,  0.6294,  0.6294,  0.6294,  0.6294,
     &  0.6294,  0.6294,  0.6294,  0.6294,  0.6294,  0.6294,  0.6294,
     &  0.6294,  0.6294,  0.6294,  0.6294,  0.6294,  0.6327,  0.6375,
     &  0.6430,  0.6491,  0.6555,  0.6625,  0.6698,  0.6771,  0.6844,
     &  0.6921,  0.6997,  0.7072,  0.7143,  0.7210,  0.7273,  0.7331,
     &  0.7385,  0.7436,  0.7483,  0.7528,  0.7570,  0.7610,  0.7647,
     &  0.7682,  0.7715,  0.7744,  0.7770,  0.7793,  0.7812,  0.7827,
     &  0.7840,  0.7850,  0.7858/
  
!  5.0000microns
      DATA  Feqevir/  0.0363,  0.0363,  0.0363,  0.0363,  0.0363,
     &  0.0363,  0.0363,  0.0363,  0.0363,  0.0363,  0.0363,  0.0363,
     &  0.0363,  0.0363,  0.0363,  0.0363,  0.0363,  0.0377,  0.0399,
     &  0.0428,  0.0467,  0.0517,  0.0590,  0.0696,  0.0850,  0.1102,
     &  0.1570,  0.2513,  0.4509,  0.8347,  1.3940,  1.9461,  2.2893,
     &  2.4047,  2.4044,  2.3736,  2.3341,  2.2923,  2.2526,  2.2175,
     &  2.1876,  2.1625,  2.1415,  2.1241,  2.1096,  2.0974,  2.0870,
     &  2.0782,  2.0706,  2.0639/
  
!      DATA  Feg0vir/ -0.1515, -0.1515, -0.1515, -0.1515, -0.1515,
!     & -0.1515, -0.1515, -0.1515, -0.1515, -0.1515, -0.1515, -0.1515,
!     & -0.1515, -0.1515, -0.1515, -0.1515, -0.1515, -0.1550, -0.1603,
!     & -0.1669, -0.1749, -0.1841, -0.1952, -0.2073, -0.2187, -0.2281,
!     & -0.2331, -0.2306, -0.2177, -0.1927, -0.1544, -0.0938,  0.0065,
!     &  0.1377,  0.2683,  0.3653,  0.4277,  0.4671,  0.4920,  0.5076,
!     &  0.5171,  0.5228,  0.5260,  0.5277,  0.5285,  0.5286,  0.5283,
!     &  0.5279,  0.5272,  0.5266/
 
      DATA  Feg0vir/  0.1515,  0.1515,  0.1515, 0.1515, 0.1515,
     &  0.1515,  0.1515,  0.1515,  0.1515,  0.1515,  0.1515,  0.1515,
     &  0.1515,  0.1515,  0.1515,  0.1515,  0.1515,  0.1550,  0.1603,
     &  0.1669,  0.1749,  0.1841,  0.1952,  0.2073,  0.2187,  0.2281,
     &  0.2331,  0.2306,  0.2177,  0.1927,  0.1544,  0.0938,  0.0065,
     &  0.1377,  0.2683,  0.3653,  0.4277,  0.4671,  0.4920,  0.5076,
     &  0.5171,  0.5228,  0.5260,  0.5277,  0.5285,  0.5286,  0.5283,
     &  0.5279,  0.5272,  0.5266/
 
      DATA  Fepi0vir/  0.0652,  0.0652,  0.0652,  0.0652,  0.0652,
     &  0.0652,  0.0652,  0.0652,  0.0652,  0.0652,  0.0652,  0.0652,
     &  0.0652,  0.0652,  0.0652,  0.0652,  0.0652,  0.0690,  0.0754,
     &  0.0844,  0.0971,  0.1153,  0.1439,  0.1889,  0.2547,  0.3508,
     &  0.4813,  0.6269,  0.7555,  0.8426,  0.8908,  0.9161,  0.9293,
     &  0.9364,  0.9404,  0.9432,  0.9455,  0.9473,  0.9487,  0.9499,
     &  0.9508,  0.9515,  0.9521,  0.9526,  0.9529,  0.9532,  0.9535,
     &  0.9537,  0.9538,  0.9540/
  
! Ca2SiO4             
!  0.6500microns
      DATA Ca2SiO4qevis/  0.7367,  0.7367,  0.7367,  0.7367,  0.7367,
     &  0.7367,  0.7367,  0.7367,  0.7367,  0.7367,  0.7367,  0.7367,
     &  0.7367,  0.7367,  0.7367,  0.7367,  0.7367,  0.7901,  0.8777,
     &  0.9935,  1.1464,  1.3521,  1.6531,  2.0530,  2.5176,  3.0371,
     &  3.5083,  3.7266,  3.5450,  3.0764,  2.6917,  2.4897,  2.4562,
     &  2.3968,  2.3294,  2.2732,  2.2293,  2.1905,  2.1578,  2.1331,
     &  2.1113,  2.0927,  2.0776,  2.0648,  2.0543,  2.0450,  2.0375,
     &  2.0312,  2.0260,  2.0216/

      DATA Ca2SiO4g0vis/  0.4580,  0.4580,  0.4580,  0.4580,  0.4580,
     &  0.4580,  0.4580,  0.4580,  0.4580,  0.4580,  0.4580,  0.4580,
     &  0.4580,  0.4580,  0.4580,  0.4580,  0.4580,  0.4682,  0.4828,
     &  0.4991,  0.5176,  0.5396,  0.5676,  0.5954,  0.6177,  0.6395,
     &  0.6510,  0.6466,  0.6184,  0.5777,  0.5685,  0.6040,  0.6579,
     &  0.6895,  0.7073,  0.7229,  0.7374,  0.7495,  0.7605,  0.7688,
     &  0.7764,  0.7832,  0.7892,  0.7951,  0.8008,  0.8071,  0.8140,
     &  0.8217,  0.8306,  0.8408/

      DATA Ca2SiO4pi0vis/  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,
     &  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,
     &  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9992,  0.9993,
     &  0.9993,  0.9993,  0.9994,  0.9994,  0.9994,  0.9995,  0.9995,
     &  0.9994,  0.9993,  0.9991,  0.9987,  0.9981,  0.9974,  0.9967,
     &  0.9960,  0.9950,  0.9936,  0.9922,  0.9903,  0.9878,  0.9846,
     &  0.9804,  0.9750,  0.9679,  0.9589,  0.9474,  0.9329,  0.9147,
     &  0.8923,  0.8651,  0.8331/

!  5.0000microns
      DATA Ca2SiO4qevir/  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,
     &  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,
     &  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0028,  0.0030,
     &  0.0031,  0.0034,  0.0037,  0.0042,  0.0050,  0.0063,  0.0083,
     &  0.0122,  0.0197,  0.0358,  0.0714,  0.1504,  0.3172,  0.6650,
     &  1.2616,  2.1096,  3.0201,  3.5700,  3.4058,  2.8598,  2.5203,
     &  2.4293,  2.3751,  2.3109,  2.2531,  2.2104,  2.1742,  2.1452,
     &  2.1207,  2.1006,  2.0837/

      DATA Ca2SiO4g0vir/  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,
     &  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,
     &  0.0077,  0.0077,  0.0077,  0.0077,  0.0077,  0.0081,  0.0087,
     &  0.0095,  0.0106,  0.0121,  0.0143,  0.0176,  0.0222,  0.0292,
     &  0.0400,  0.0566,  0.0829,  0.1256,  0.1978,  0.3235,  0.4760,
     &  0.5777,  0.6511,  0.6966,  0.7099,  0.6855,  0.6497,  0.6671,
     &  0.7294,  0.7781,  0.8088,  0.8348,  0.8601,  0.8831,  0.9028,
     &  0.9190,  0.9311,  0.9391/

      DATA Ca2SiO4pi0vir/  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,
     &  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,
     &  0.0788,  0.0788,  0.0788,  0.0788,  0.0788,  0.0839,  0.0924,
     &  0.1040,  0.1200,  0.1423,  0.1755,  0.2246,  0.2907,  0.3793,
     &  0.4910,  0.6130,  0.7285,  0.8213,  0.8844,  0.9217,  0.9436,
     &  0.9561,  0.9624,  0.9635,  0.9583,  0.9421,  0.9110,  0.8745,
     &  0.8456,  0.8176,  0.7848,  0.7472,  0.7077,  0.6681,  0.6315,
     &  0.6004,  0.5771,  0.5619/ 
! CaTiO3              
!  0.6500microns
      DATA  CaTiO3qevis/  2.9052,  2.9052,  2.9052,  2.9052,  2.9052,
     &  2.9052,  2.9052,  2.9052,  2.9052,  2.9052,  2.9052,  2.9052,
     &  2.9052,  2.9052,  2.9052,  2.9052,  2.9052,  3.0284,  3.2079,
     &  3.4112,  3.6250,  3.8415,  3.9781,  3.9935,  3.7963,  3.4537,
     &  3.1002,  2.8277,  2.6840,  2.6410,  2.5768,  2.4927,  2.4135,
     &  2.3501,  2.2995,  2.2543,  2.2152,  2.1811,  2.1527,  2.1290,
     &  2.1079,  2.0903,  2.0800,  2.0636,  2.0532,  2.0445,  2.0370,
     &  2.0310,  2.0258,  2.0215/
  
      DATA  CaTiO3g0vis/  0.4001,  0.4001,  0.4001,  0.4001,  0.4001,
     &  0.4001,  0.4001,  0.4001,  0.4001,  0.4001,  0.4001,  0.4001,
     &  0.4001,  0.4001,  0.4001,  0.4001,  0.4001,  0.3999,  0.3984,
     &  0.3950,  0.3890,  0.3788,  0.3683,  0.3475,  0.3240,  0.3048,
     &  0.3147,  0.3597,  0.4192,  0.4746,  0.5033,  0.5283,  0.5535,
     &  0.5779,  0.5994,  0.6186,  0.6361,  0.6522,  0.6680,  0.6835,
     &  0.6998,  0.7168,  0.7360,  0.7547,  0.7751,  0.7955,  0.8146,
     &  0.8314,  0.8444,  0.8534/
  
      DATA  CaTiO3pi0vis/  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,
     &  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,
     &  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,  0.9970,
     &  0.9969,  0.9969,  0.9966,  0.9963,  0.9957,  0.9947,  0.9931,
     &  0.9907,  0.9878,  0.9854,  0.9839,  0.9811,  0.9785,  0.9750,
     &  0.9705,  0.9642,  0.9567,  0.9469,  0.9348,  0.9198,  0.9011,
     &  0.8788,  0.8522,  0.8221,  0.7879,  0.7520,  0.7160,  0.6822,
     &  0.6532,  0.6307,  0.6154/
  
!  5.0000microns
      DATA  CaTiO3qevir/  0.0014,  0.0014,  0.0014,  0.0014,  0.0014,
     &  0.0014,  0.0014,  0.0014,  0.0014,  0.0014,  0.0014,  0.0014,
     &  0.0014,  0.0014,  0.0014,  0.0014,  0.0014,  0.0015,  0.0016,
     &  0.0018,  0.0021,  0.0026,  0.0033,  0.0046,  0.0070,  0.0114,
     &  0.0209,  0.0419,  0.0920,  0.2166,  0.5453,  1.4257,  2.6418,
     &  3.7190,  3.9209,  3.3622,  2.8526,  2.6437,  2.5770,  2.4889,
     &  2.4102,  2.3403,  2.2846,  2.2390,  2.2003,  2.1674,  2.1402,
     &  2.1175,  2.0985,  2.0822/
  
      DATA  CaTiO3g0vir/  0.0104,  0.0104,  0.0104,  0.0104,  0.0104,
     &  0.0104,  0.0104,  0.0104,  0.0104,  0.0104,  0.0104,  0.0104,
     &  0.0104,  0.0104,  0.0104,  0.0104,  0.0104,  0.0109,  0.0117,
     &  0.0128,  0.0142,  0.0162,  0.0192,  0.0237,  0.0300,  0.0395,
     &  0.0544,  0.0777,  0.1161,  0.1842,  0.3207,  0.4194,  0.4390,
     &  0.4363,  0.4050,  0.3638,  0.3972,  0.4801,  0.5440,  0.5782,
     &  0.6116,  0.6429,  0.6719,  0.6993,  0.7258,  0.7516,  0.7770,
     &  0.8013,  0.8237,  0.8431/
  
      DATA  CaTiO3pi0vir/  0.4571,  0.4571,  0.4571,  0.4571,  0.4571,
     &  0.4571,  0.4571,  0.4571,  0.4571,  0.4571,  0.4571,  0.4571,
     &  0.4571,  0.4571,  0.4571,  0.4571,  0.4571,  0.4739,  0.5002,
     &  0.5329,  0.5727,  0.6196,  0.6761,  0.7393,  0.8002,  0.8561,
     &  0.9033,  0.9382,  0.9618,  0.9761,  0.9831,  0.9866,  0.9875,
     &  0.9863,  0.9816,  0.9705,  0.9561,  0.9444,  0.9359,  0.9249,
     &  0.9107,  0.8930,  0.8716,  0.8464,  0.8171,  0.7843,  0.7490,
     &  0.7129,  0.6784,  0.6479/
  
! Al2O3               
!  0.6500microns
      DATA  Al2O3qevis/  0.7312,  0.7312,  0.7312,  0.7312,  0.7312,
     &  0.7312,  0.7312,  0.7312,  0.7312,  0.7312,  0.7312,  0.7312,
     &  0.7312,  0.7312,  0.7312,  0.7312,  0.7312,  0.7771,  0.8525,
     &  0.9524,  1.0843,  1.2595,  1.5104,  1.8498,  2.2481,  2.7081,
     &  3.1577,  3.4483,  3.4360,  3.1239,  2.7603,  2.5272,  2.4442,
     &  2.3882,  2.3276,  2.2726,  2.2275,  2.1903,  2.1591,  2.1329,
     &  2.1110,  2.0927,  2.0773,  2.0645,  2.0538,  2.0449,  2.0374,
     &  2.0311,  2.0259,  2.0216/
  
      DATA  Al2O3g0vis/  0.4534,  0.4534,  0.4534,  0.4534,  0.4534,
     &  0.4534,  0.4534,  0.4534,  0.4534,  0.4534,  0.4534,  0.4534,
     &  0.4534,  0.4534,  0.4534,  0.4534,  0.4534,  0.4653,  0.4827,
     &  0.5026,  0.5251,  0.5512,  0.5836,  0.6179,  0.6482,  0.6780,
     &  0.7019,  0.7156,  0.7149,  0.7035,  0.7065,  0.7473,  0.8099,
     &  0.8576,  0.8875,  0.9086,  0.9236,  0.9328,  0.9378,  0.9401,
     &  0.9412,  0.9417,  0.9420,  0.9422,  0.9423,  0.9423,  0.9423,
     &  0.9423,  0.9422,  0.9422/
  
      DATA  Al2O3pi0vis/  0.8021,  0.8021,  0.8021,  0.8021,  0.8021,
     &  0.8021,  0.8021,  0.8021,  0.8021,  0.8021,  0.8021,  0.8021,
     &  0.8021,  0.8021,  0.8021,  0.8021,  0.8021,  0.8067,  0.8136,
     &  0.8214,  0.8298,  0.8384,  0.8474,  0.8566,  0.8632,  0.8670,
     &  0.8649,  0.8535,  0.8265,  0.7781,  0.7153,  0.6590,  0.6250,
     &  0.5995,  0.5758,  0.5569,  0.5452,  0.5403,  0.5399,  0.5419,
     &  0.5445,  0.5469,  0.5488,  0.5503,  0.5513,  0.5521,  0.5526,
     &  0.5529,  0.5531,  0.5532/
  
!  5.0000microns
      DATA  Al2O3qevir/  0.0060,  0.0060,  0.0060,  0.0060,  0.0060,
     &  0.0060,  0.0060,  0.0060,  0.0060,  0.0060,  0.0060,  0.0060,
     &  0.0060,  0.0060,  0.0060,  0.0060,  0.0060,  0.0062,  0.0064,
     &  0.0067,  0.0072,  0.0078,  0.0086,  0.0099,  0.0116,  0.0143,
     &  0.0188,  0.0266,  0.0417,  0.0727,  0.1374,  0.2680,  0.5258,
     &  0.9812,  1.6665,  2.5023,  3.2238,  3.4345,  3.0562,  2.6219,
     &  2.4173,  2.3693,  2.3124,  2.2567,  2.2107,  2.1756,  2.1456,
     &  2.1210,  2.1006,  2.0837/
  
      DATA  Al2O3g0vir/  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,
     &  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,
     &  0.0075,  0.0075,  0.0075,  0.0075,  0.0075,  0.0078,  0.0084,
     &  0.0091,  0.0102,  0.0116,  0.0138,  0.0169,  0.0214,  0.0282,
     &  0.0386,  0.0546,  0.0800,  0.1212,  0.1900,  0.3083,  0.4662,
     &  0.5843,  0.6719,  0.7302,  0.7619,  0.7636,  0.7398,  0.7314,
     &  0.7715,  0.8295,  0.8686,  0.8951,  0.9162,  0.9325,  0.9435,
     &  0.9500,  0.9534,  0.9549/
  
      DATA  Al2O3pi0vir/  0.0281,  0.0281,  0.0281,  0.0281,  0.0281,
     &  0.0281,  0.0281,  0.0281,  0.0281,  0.0281,  0.0281,  0.0281,
     &  0.0281,  0.0281,  0.0281,  0.0281,  0.0281,  0.0300,  0.0332,
     &  0.0377,  0.0440,  0.0531,  0.0671,  0.0891,  0.1216,  0.1711,
     &  0.2457,  0.3485,  0.4755,  0.6086,  0.7226,  0.8031,  0.8550,
     &  0.8884,  0.9078,  0.9164,  0.9140,  0.8952,  0.8514,  0.7892,
     &  0.7342,  0.6966,  0.6594,  0.6228,  0.5908,  0.5669,  0.5513,
     &  0.5431,  0.5403,  0.5402/
  

!cloudspecies=['KCl','ZnS','Na2S','MnS','Cr2O3','SiO2','Mg2SiO4','VO','Ni','Fe','Ca2SiO4','CaTiO3','Al2O3']
      Tconds(1:51,1)=TconKCl
      Tconds(1:51,2)=TconZnS
      Tconds(1:51,3)=TconNa2S
      Tconds(1:51,4)=TconMnS
      Tconds(1:51,5)=TconCr2O3
      Tconds(1:51,6)=TconSiO2
      Tconds(1:51,7)=TconMg2SiO4
      Tconds(1:51,8)=TconVO
      Tconds(1:51,9)=TconNi
      Tconds(1:51,10)=TconFe
      Tconds(1:51,11)=TconCa2SiO4
      Tconds(1:51,12)=TconCaTiO3
      Tconds(1:51,13)=TconAl2O3 

      g0vis(1:50,1)=KClg0vis
      g0vis(1:50,2)=ZnSg0vis
      g0vis(1:50,3)=Na2Sg0vis
      g0vis(1:50,4)=MnSg0vis
      g0vis(1:50,5)=Cr2O3g0vis
      g0vis(1:50,6)=SiO2g0vis
      g0vis(1:50,7)=Mg2SiO4g0vis
      g0vis(1:50,8)=VOg0vis
      g0vis(1:50,9)=Nig0vis
      g0vis(1:50,10)=Feg0vis
      g0vis(1:50,11)=Ca2SiO4g0vis
      g0vis(1:50,12)=CaTiO3g0vis
      g0vis(1:50,13)=Al2O3g0vis

      g0ir(1:50,1)=KClg0vir
      g0ir(1:50,2)=ZnSg0vir
      g0ir(1:50,3)=Na2Sg0vir
      g0ir(1:50,4)=MnSg0vir
      g0ir(1:50,5)=Cr2O3g0vir
      g0ir(1:50,6)=SiO2g0vir
      g0ir(1:50,7)=Mg2SiO4g0vir
      g0ir(1:50,8)=VOg0vir
      g0ir(1:50,9)=Nig0vir
      g0ir(1:50,10)=Feg0vir
      g0ir(1:50,11)=Ca2SiO4g0vir
      g0ir(1:50,12)=CaTiO3g0vir
      g0ir(1:50,13)=Al2O3g0vir

      pi0vis(1:50,1)=KClpi0vis
      pi0vis(1:50,2)=ZnSpi0vis
      pi0vis(1:50,3)=Na2Spi0vis
      pi0vis(1:50,4)=MnSpi0vis
      pi0vis(1:50,5)=Cr2O3pi0vis
      pi0vis(1:50,6)=SiO2pi0vis
      pi0vis(1:50,7)=Mg2SiO4pi0vis
      pi0vis(1:50,8)=VOpi0vis
      pi0vis(1:50,9)=Nipi0vis
      pi0vis(1:50,10)=Fepi0vis
      pi0vis(1:50,11)=Ca2SiO4pi0vis
      pi0vis(1:50,12)=CaTiO3pi0vis
      pi0vis(1:50,13)=Al2O3pi0vis

      pi0ir(1:50,1)=KClpi0vir
      pi0ir(1:50,2)=ZnSpi0vir
      pi0ir(1:50,3)=Na2Spi0vir
      pi0ir(1:50,4)=MnSpi0vir
      pi0ir(1:50,5)=Cr2O3pi0vir
      pi0ir(1:50,6)=SiO2pi0vir
      pi0ir(1:50,7)=Mg2SiO4pi0vir
      pi0ir(1:50,8)=VOpi0vir
      pi0ir(1:50,9)=Nipi0vir
      pi0ir(1:50,10)=Fepi0vir
      pi0ir(1:50,11)=Ca2SiO4pi0vir
      pi0ir(1:50,12)=CaTiO3pi0vir
      pi0ir(1:50,13)=Al2O3pi0vir

      qevis(1:50,1)=KClqevis
      qevis(1:50,2)=ZnSqevis
      qevis(1:50,3)=Na2Sqevis
      qevis(1:50,4)=MnSqevis
      qevis(1:50,5)=Cr2O3qevis
      qevis(1:50,6)=SiO2qevis
      qevis(1:50,7)=Mg2SiO4qevis
      qevis(1:50,8)=VOqevis
      qevis(1:50,9)=Niqevis
      qevis(1:50,10)=Feqevis
      qevis(1:50,11)=Ca2SiO4qevis
      qevis(1:50,12)=CaTiO3qevis
      qevis(1:50,13)=Al2O3qevis

      qeir(1:50,1)=KClg0vir
      qeir(1:50,2)=ZnSg0vir
      qeir(1:50,3)=Na2Sg0vir
      qeir(1:50,4)=MnSg0vir
      qeir(1:50,5)=Cr2O3g0vir
      qeir(1:50,6)=SiO2g0vir
      qeir(1:50,7)=Mg2SiO4g0vir
      qeir(1:50,8)=VOg0vir
      qeir(1:50,9)=Nig0vir
      qeir(1:50,10)=Feg0vir
      qeir(1:50,11)=Ca2SiO4g0vir
      qeir(1:50,12)=CaTiO3g0vir
      qeir(1:50,13)=Al2O3g0vir


!     The mass of these layers is this pressure thickness divide by G.
!    
!     (NOTE - THE TOP LAYER IS FROM PTOP TO 0, SO AVERAGE = PTOP/2)
!     P_aerad=PRESSURE AT EDGES OF LAYERS (PASCALS) 
!     PRESS - PRESSURE AT EDGE OF LAYER (dyne/cm^2)
!     DPG   - MASS OF LAYER (G / CM**2)!    D PBAR 
!     PBARS - THICKNESS OF LAYER IN PRESSURE (BARS)
!     PRESSMID- PRESSURE AT CENTER OF LAYER (dyne/cm^2
     

 
      Do 200  I         = 1,NCLOUD
       DO 180  J          =   1,NLAYER -1 
        CONDFACT(J,I)     =min(max((Tconds(J,I)-TT(J))/10.,0.0),1.0)
        TAUFACT= DPG(J)*10.*molef(I)*3./4./rps(J)/density(I)*fmolw(I)
     &            *CONDFACT(J,I)*MTLX*CORFACT(J)
        TAUAERSW(J,I)     =TAUFACT*qevis(J,I)
        TAUAERLW(J,I)     =TAUFACT*qeir(J,I)
        CLOUDLOC(J,I)     =NINT(CONDFACT(J,I))*J
        ZEROARR(J)        =0.
       
180   CONTINUE
!uncomment this section for compact cloud
        BASELEV         = MAXVAL(CLOUDLOC(1:50,I),1)
        TOPLEV          = max(BASELEV-AERLAYERS,0)  !changed from 1 to 0
        DO 185  J       = 1,TOPLEV
         TAUAERSW(J,I)       = 0.
         TAUAERLW(J,I)       = 0.
185   CONTINUE
         TAUAERSW(TOPLEV+2,I)= TAUAERSW(TOPLEV+2,I)*0.367879 !i.e.e(-2)
         TAUAERLW(TOPLEV+2,I)= TAUAERLW(TOPLEV+2,I)*0.367879 
         TAUAERSW(TOPLEV+1,I)= TAUAERSW(TOPLEV+1,I)*0.135335 !i.e.e(-1)
         TAUAERLW(TOPLEV+1,I)= TAUAERLW(TOPLEV+1,I)*0.135335
186   CONTINUE
200   CONTINUE


! SW AT STANDARD VERTICAL RESOLUTION
      DO 220    J     =  1,NLAYER
       TAUAER(1,J)    = SUM(TAUAERSW(J,1:13))
       WOL(1,J)       = SUM(TAUAERSW(J,1:13)/(TAUAER(1,J)+1e-8)
     &                      * PI0vis(J,1:13))
       GOL(1,J)       = SUM(TAUAERSW(J,1:13)/(TAUAER(1,J)+1e-8)
     &                      * g0vis(J,1:13))
220   CONTINUE

! LW AT 2X VERTICAL RESOLUTION (FOR PERFORMANCE).
               k         =  1
      DO 240  J          =   1,NDBL,2
              JJ         = J  
       TAUAER(2,JJ)       = SUM(TAUAERLW(K,1:13))


       WOL(2,JJ)  = SUM(TAUAERLW(K,1:13)/(SUM(TAUAERLW(K,1:13))+1e-8)
     &                      * PI0ir(k,1:13))
       GOL(2,JJ)  = SUM(TAUAERLW(K,1:13)/(SUM(TAUAERLW(K,1:13))+1e-8)
     &                      * g0ir(k,1:13))
    
              JJ          = J+1
       TAUAER(2,JJ)       = TAUAER(2,JJ-1)
       WOL(2,JJ)          = WOL(2,JJ-1)
       GOL(2,JJ)          = GOL(2,JJ-1)
             k            = k+1
240   CONTINUE

!     iradgas = 0: no gas in radiative xfer!
      iradgas = 1     

      DO 500 J           = 1,NLAYER
          j1             = max( 1, j-1 )
!
!     First the solar at standard resolution
          DO 400 L       = LLS,NSOLP
!M          DO 400 L       = LLS,LLA
 
!MTR              TAUL(L,J)   = TAUH2O(L,J)+TAUGAS(L,J)+   &
!MTR                               PARAY(L,J)+TAUAER(L,J)+TAUCLD(L,J)
!              THE CODE ORIGINALLY INCLUDED TAUCLD AS WELL AS TAUAER. I
!              DO NOT SEE THE POINT OF HAVING BOTH OPTICAL DEPTHS IN OUR
!              MODEL SO I AM OMMITTING TAUCLD, W0CLD, GCLD, ETC

          TAUL(L,J) = TAUGAS(L,J)+TAURAY(L,J)+TAUAER(L,J)!+TAUCLD(L,J)
             
             if (iradgas.eq.0) then
             tauL(L,j) = tauaer(L,j)
             endif

             if( TAUL(L,J) .lt. EPSILON ) then
             TAUL(L,J) = EPSILON
             endif

             utauL(L,j)  = TAUL(L,J)
          WOT         = (TAURAY(L,J)+TAUAER(L,J)*WOL(L,J))/TAUL(L,J)
             if (iradgas.eq.0) then
              wot = woL(L,j)
             endif
 
             WOT         = min(1.-EPSILON,WOT)
             uw0(L,j)    = WOT
!             write(*,*) 'WOT',WOT
             DENOM       = (TAURAY(L,J)+ TAUAER(L,J)*WOL(L,J))
             if( DENOM .LE. EPSILON ) then 
             DENOM = EPSILON then
             endif
             if( DENOM .GT. EPSILON ) then
               GOT = ( GOL(L,J)* WOL(L,J)*TAUAER(L,J) ) / DENOM
!       print*, j, L, GCLD(l,j), gol(l,j),wol(l,j),got
             else
               GOT = 0.
             endif
             if (iradgas.eq.0) then
             GOT = goL(L,j)
             endif
             ug0(L,j)    = GOT
             uOPD(L,J)   = 0.0
             uOPD(L,J)   = uOPD(L,J1)+uTAUL(L,J)
             IF (deltascale) THEN
             FO          = GOT*GOT
             DEN         = 1.-WOT*FO
             TAUL(L,J)   = TAUL(L,J) * DEN
             W0(L,J)     = (1.-FO)*WOT/DEN
             G0(L,J)     = GOT/(1.+GOT)
             OPD(L,J)    = 0.0
             OPD(L,J)    = OPD(L,J1)+TAUL(L,J)             
             ELSE 
                  W0(L,J)= uw0(L,J)
                  G0(L,J)= ug0(L,J)
                TAUL(L,J)= utaul(L,J)
                 OPD(L,J)= uOPD(L,J)
             ENDIF 
!!!!!!!!!!!!!!!!HERE'S WHERE YOU CAN HARDWIRE VALUES!!!!!!!!!
 
             if( taul(L,j).lt.0. ) then
       write(*,*) 'taul lt 0'
       stop
       endif
                       
 400        CONTINUE
           
!MTR          IF(IR .EQ. 1) THEN
!MTR             DO 450 I        =   1,NGAUSS
!MTR                DO 425 L     =   LLS,LLA
!MTR                   Y3(L,I,J) =   EXP(-TAUL(L,J)/GANGLE(I))
!MTR 425            CONTINUE
!MTR 450         CONTINUE
!          ENDIF
 500  CONTINUE
!       write(*,*) 'tauaer',tauaer
!       DO 667 I  = 1,NDBL
!       write(*,*) 'tauaersw',TAUAER(1,I)
! 667   CONTINUE
!       DO 668 I  = 1,NDBL
!       write(*,*) 'tauaerlw',TAUAER(2,I)
! 668   CONTINUE


!      NOW AGAIN FOR THE IR
      DO 501 J           = 1,NDBL
          j1             = max( 1, j-1 )
!
!     First the solar at standard resolution
          DO 401 L       = NSOLP+1,NTOTAL

         TAUL(L,J)  =  TAUGAS(L,J)+TAURAY(L,J)+TAUAER(L,J)!+TAUCLD(L,J)
             if (iradgas.eq.0) then
             tauL(L,j) = tauaer(L,j)
             endif

             if( TAUL(L,J) .lt. EPSILON ) then
             TAUL(L,J) = EPSILON
             endif

             utauL(L,j)  = TAUL(L,J)
          WOT         = (TAURAY(L,J)+TAUAER(L,J)*WOL(L,J))/TAUL(L,J)
             if (iradgas.eq.0) then
              wot = woL(L,j)
             endif

             WOT         = min(1.-EPSILON,WOT)
             uw0(L,j)    = WOT
             DENOM       = (TAURAY(L,J)+ TAUAER(L,J)*WOL(L,J))
             if( DENOM .LE. EPSILON ) then
             DENOM = EPSILON then
             endif
             if( DENOM .GT. EPSILON ) then
               GOT = ( GOL(L,J)* WOL(L,J)*TAUAER(L,J) ) / DENOM        
             else
               GOT = 0.
             endif
             if (iradgas.eq.0) then
             GOT = goL(L,j)
             endif
             ug0(L,j)    = GOT
             uOPD(L,J)   = 0.0
             uOPD(L,J)   = uOPD(L,J1)+uTAUL(L,J)
             IF (deltascale) THEN
             FO          = GOT*GOT
             DEN         = 1.-WOT*FO
             TAUL(L,J)   = TAUL(L,J) * DEN
             W0(L,J)     = (1.-FO)*WOT/DEN
             G0(L,J)     = GOT/(1.+GOT)
             OPD(L,J)    = 0.0
             OPD(L,J)    = OPD(L,J1)+TAUL(L,J)
             ELSE
                  W0(L,J)= uw0(L,J)
                  G0(L,J)= ug0(L,J)
                TAUL(L,J)= utaul(L,J)
                 OPD(L,J)= uOPD(L,J)
             ENDIF

             if( taul(L,j).lt.0. ) then
       write(*,*) 'taul lt 0'
       stop
       endif
          
            
 401        CONTINUE

          IF(IR .EQ. 1) THEN
             DO 450 I        =   1,NGAUSS
                DO 425 L     =   LLS,LLA
                   Y3(L,I,J) =   EXP(-TAUL(L,J)/GANGLE(I))
 425            CONTINUE
 450         CONTINUE
          ENDIF
 501  CONTINUE

!      DO J = 1,NDBL 
!      write(*,*) 'W0',J,W0(2,J)
!      ENDDO 
!      DO J = 1,NDBL
!      write(*,*) 'G0',J,G0(2,J)
!      ENDDO
!      DO J = 1,NDBL
!      write(*,*) 'WOL',J,WOL(2,J)
!      ENDDO
!      stop
!      DO J = 1,NDBL
!      write(*,*) 'GOL',J,GOL(2,J)
!      ENDDO
!      DO J = 1,NDBL
!      write(*,*) 'TAURAY',J,TAURAY(2,J)
!      ENDDO
!      DO J = 1,NDBL
!      write(*,*) 'TAUAER',J,TAUAER(2,J)
!      ENDDO
!      DO J = 1,NDBL
!      write(*,*) 'TAUGAS',J,TAUGAS(2,J)
!      ENDDO
!      DO J = 1,NDBL
!      write(*,*) 'TAUL',J,TAUL(1,J),TAUL(2,J)
!      ENDDO
!     DO J = 1,NDBL
!      write(*,*) 'OPD',J,OPD(2,J) 
!      ENDDO     
!         stop
      RETURN
      END

